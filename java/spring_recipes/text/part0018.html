<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Chapter 8 Spring Mobile</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre"><p class="ChapterNumber"><a id="b9781430259084_8" class="calibre6"></a>CHAPTER 8</p>
<p class="Chapimage"><img src="../images/00008.jpeg" alt="image" class="calibre3"/></p>
<p class="ChapterTitle">Spring Mobile</p>
<div class="calibre10"><p class="noindent">In the current world, more and more mobile devices exist. Most of these mobile devices can access the internet and access websites. Mobile devices might have a browser that lacks certain HTML or JavaScript features you might use on your website, you also might want to show a different website to your mobile users or maybe give them the choice.</p>
<p class="indent">You could write all the device detection routines yourself; however, Spring Mobile provides ways to detect the device and to act upon it.</p>
<p id="Sec1" class="Heading">Recipe 8-1. Device detection without Spring Mobile</p>
<p id="Sec2" class="Heading1">Problem</p>
<p class="noindent">You want to detect the type of device that connects to your website.</p>
<p id="Sec3" class="Heading1">Solution</p>
<p class="noindent">Create a Filter that detects the User-Agent of the incoming request and sets a request attribute so that it can be retrieved in a controller.</p>
<p id="Sec4" class="Heading1">How It Works</p>
<p class="noindent">First, let’s take a look at the <span class="FontName">Filter</span> implementation<a id="cXXX.599" class="calibre5"></a> we need to do User-Agent based device detection.</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.mobile.web.filter;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import org.springframework.util.StringUtils;</span><br class="calibre10"/><span class="FontName">import org.springframework.web.filter.OncePerRequestFilter;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import javax.servlet.FilterChain;</span><br class="calibre10"/><span class="FontName">import javax.servlet.ServletException;</span><br class="calibre10"/><span class="FontName">import javax.servlet.http.HttpServletRequest;</span><br class="calibre10"/><span class="FontName">import javax.servlet.http.HttpServletResponse;</span><br class="calibre10"/><span class="FontName">import java.io.IOException;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">public class DeviceResolverRequestFilter extends OncePerRequestFilter {</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">public static final String CURRENT_DEVICE_ATTRIBUTE = "currentDevice";</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">public static final String DEVICE_MOBILE = "MOBILE";</span><br class="calibre10"/>    <span class="FontName">public static final String DEVICE_TABLET = "TABLET";</span><br class="calibre10"/>    <span class="FontName">public static final String DEVICE_NORMAL = "NORMAL";</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@Override</span><br class="calibre10"/>    <span class="FontName">protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response,</span><br class="calibre10"/>                                    <span class="FontName">FilterChain filterChain) throws ServletException, IOException {</span><br class="calibre10"/>        <b class="calibre4">String userAgent = request.getHeader("User-Agent");</b><br class="calibre10"/>        <span class="FontName">String device = DEVICE_NORMAL;</span><br class="calibre10"/><br class="calibre10"/>        <span class="FontName">if (StringUtils.hasText(userAgent)) {</span><br class="calibre10"/>            <span class="FontName">userAgent = userAgent.toLowerCase();</span><br class="calibre10"/>            <span class="FontName">if (userAgent.contains("android")) {</span><br class="calibre10"/>                <span class="FontName">device = userAgent.contains("mobile") ? DEVICE_NORMAL : DEVICE_TABLET;</span><br class="calibre10"/>            <span class="FontName">} else if (userAgent.contains("ipad") || userAgent.contains("playbook") || userAgent.contains("kindle")) {</span><br class="calibre10"/>                <span class="FontName">device = DEVICE_TABLET;</span><br class="calibre10"/>            <span class="FontName">} else if (userAgent.contains("mobil") || userAgent.contains("ipod") || userAgent.contains("nintendo DS")) {</span><br class="calibre10"/>                <span class="FontName">device = DEVICE_MOBILE;</span><br class="calibre10"/>            <span class="FontName">}</span><br class="calibre10"/>        <span class="FontName">}</span><br class="calibre10"/>        <span class="FontName">request.setAttribute(CURRENT_DEVICE_ATTRIBUTE, device);</span><br class="calibre10"/>        <span class="FontName">filterChain.doFilter(request, response);</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">First there is the retrieval of the <span class="FontName">User-Agent</span><a id="cXXX.600" class="calibre5"></a> header from the incoming request. When there is a value in there the filter needs to check what is in the header. There are some if/else constructs in there to do a basic detection of the type of device. There is a special case for Android as that can be a tablet or mobile.</p>
<p class="indent">When the filter determined what the type of device is, it is stored as a request attribute so that it is available to other components.</p>
<p class="indent">Next there is a controller and jsp to display some information on what is going on. The controller simply directs to a <span class="FontName">home.jsp</span><a id="cXXX.601" class="calibre5"></a> which is located in the <span class="FontName">WEB-INF/views</span> directory. A configured InternalResourceViewResolver takes care of resolving the name to an actual JSP (for more information check the recipes in <a href="part0014.html" class="calibre5">Chapter 4</a>).</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.mobile.web;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import org.springframework.stereotype.Controller;</span><br class="calibre10"/><span class="FontName">import org.springframework.web.bind.annotation.RequestMapping;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import javax.servlet.http.HttpServletRequest;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">@Controller</span><br class="calibre10"/><span class="FontName">public class HomeController {</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@RequestMapping("/home")</span><br class="calibre10"/>    <span class="FontName">public String index(HttpServletRequest request) {</span><br class="calibre10"/>        <span class="FontName">return "home";</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">The home.jsp:</p>
<pre class="calibre11"><span class="FontName">&lt;%@ taglib uri="</span><span class="FontName"><a href="http://java.sun.com/jsp/jstl/core" class="calibre5">http://java.sun.com/jsp/jstl/core</a></span><span class="FontName">" prefix="c" %&gt;</span><br class="calibre10"/><span class="FontName">&lt;!doctype html&gt;</span><br class="calibre10"/><span class="FontName">&lt;html&gt;</span><br class="calibre10"/><span class="FontName">&lt;body&gt;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">&lt;h1&gt;Welcome&lt;/h1&gt;</span><br class="calibre10"/><span class="FontName">&lt;p&gt;</span><br class="calibre10"/>    <span class="FontName">Your User-Agent header: &lt;c:out value="${header['User-Agent']}" /&gt;</span><br class="calibre10"/><span class="FontName">&lt;/p&gt;</span><br class="calibre10"/><span class="FontName">&lt;p&gt;</span><br class="calibre10"/>    <span class="FontName">Your type of device: &lt;c:out value="${requestScope.currentDevice}" /&gt;</span><br class="calibre10"/><span class="FontName">&lt;/p&gt;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">&lt;/body&gt;</span><br class="calibre10"/><span class="FontName">&lt;/html&gt;</span></pre>
<p class="indent">The JSP shows the User-Agent header (if any) and the type of device, which has been determined by your own implemented <span class="FontName">DeviceResolverRequestFilter</span><a id="cXXX.602" class="calibre5"></a>.</p>
<p class="indent">Finally there is the configuration and bootstrapping logic.</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.mobile.web.config;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import org.springframework.context.annotation.Bean;</span><br class="calibre10"/><span class="FontName">import org.springframework.context.annotation.ComponentScan;</span><br class="calibre10"/><span class="FontName">import org.springframework.context.annotation.Configuration;</span><br class="calibre10"/><span class="FontName">import org.springframework.web.servlet.ViewResolver;</span><br class="calibre10"/><span class="FontName">import org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br class="calibre10"/><span class="FontName">import org.springframework.web.servlet.view.InternalResourceView;</span><br class="calibre10"/><span class="FontName">import org.springframework.web.servlet.view.InternalResourceViewResolver;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">@Configuration</span><br class="calibre10"/><span class="FontName">@EnableWebMvc</span><br class="calibre10"/><span class="FontName">@ComponentScan("com.apress.springrecipes.mobile.web")</span><br class="calibre10"/><span class="FontName">public class MobileConfiguration {</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@Bean</span><br class="calibre10"/>    <span class="FontName">public ViewResolver viewResolver() {</span><br class="calibre10"/>        <span class="FontName">InternalResourceViewResolver viewResolver = new InternalResourceViewResolver();</span><br class="calibre10"/>        <span class="FontName">viewResolver.setPrefix("/WEB-INF/views/");</span><br class="calibre10"/>        <span class="FontName">viewResolver.setSuffix(".jsp");</span><br class="calibre10"/>        <span class="FontName">return viewResolver;</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">Spring MVC is enabled by using the <span class="FontName">@EnableWebMvc</span><a id="cXXX.603" class="calibre5"></a> annotation and the controller is picked up by the <span class="FontName">@ComponentScan</span>.</p>
<p class="indent">For bootstrapping the application there is the <span class="FontName">MobileApplicationInitializer</span> this bootstraps the <span class="FontName">DispatcherServlet</span> and optionally the <span class="FontName">ContextLoaderListener</span><a id="cXXX.604" class="calibre5"></a>.</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.mobile.web;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import com.apress.springrecipes.mobile.web.config.MobileConfiguration;</span><br class="calibre10"/><span class="FontName">import com.apress.springrecipes.mobile.web.filter.DeviceResolverRequestFilter;</span><br class="calibre10"/><span class="FontName">import org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import javax.servlet.Filter;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">public class MobileApplicationInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {</span><br class="calibre10"/>    <span class="FontName">@Override</span><br class="calibre10"/>    <span class="FontName">protected Class&lt;?&gt;[] getRootConfigClasses() {</span><br class="calibre10"/>        <span class="FontName">return null;</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@Override</span><br class="calibre10"/>    <span class="FontName">protected Class&lt;?&gt;[] getServletConfigClasses() {</span><br class="calibre10"/>        <b class="calibre4">return new Class[] { MobileConfiguration.class };</b><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@Override</span><br class="calibre10"/>    <span class="FontName">protected Filter[] getServletFilters() {</span><br class="calibre10"/>        <b class="calibre4">return new Filter[] {new DeviceResolverRequestFilter()};</b><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@Override</span><br class="calibre10"/>    <span class="FontName">protected String[] getServletMappings() {</span><br class="calibre10"/>        <span class="FontName">return new String[] {"/"};</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">There are two things to notice here. First the earlier mentioned configuration class is passed to the <span class="FontName">DispatcherServlet</span> by implementing the <span class="FontName">getServletConfigClasses</span> method<a id="cXXX.605" class="calibre5"></a>. Second the implementation of the <span class="FontName">getServletFilters</span> method, which takes care of registering the filter and mapping it to the <span class="FontName">DispatcherServlet</span><a id="cXXX.606" class="calibre5"></a>.</p>
<p class="indent">When the application is deployed, using <span class="FontName">http://localhost:8080/mobile/home</span> will show you the <span class="FontName">User-Agent</span> used and what type the filter thinks it is (see <a id="_Fig1" href="part0018.html#Fig1" class="calibre5">Figure 8-1</a>).</p>
<div class="Figure" id="Fig1">
<p class="img1"><img src="../images/00063.jpeg" alt="9781430259084_Fig08-01.jpg" class="calibre3"/></p>
<p class="FigCapt"><span class="calibre4"><a href="part0018.html#_Fig1" class="calibre5">Figure 8-1</a>.</span> Viewing the application in Chrome</p></div>
<p class="indent">Using Chrome<a id="cXXX.607" class="calibre5"></a> on an iMac produces the above result. When using an iPhone 4 it looks like <a id="_Fig2" href="part0018.html#Fig2" class="calibre5">Figure 8-2</a>:</p>
<div class="Figure" id="Fig2">
<p class="img1"><img src="../images/00064.jpeg" alt="9781430259084_Fig08-02.jpg" class="calibre3"/></p>
<p class="FigCapt"><span class="calibre4"><a href="part0018.html#_Fig2" class="calibre5">Figure 8-2</a>.</span> Viewing the application using an iPhone 4<a id="cXXX.608" class="calibre5"></a></p></div>
<div class="notepara">
<p class="paraaftertitle"><img src="../images/00016.jpeg" alt="Image" class="calibre3"/> <b class="calibre4">Note</b>  For testing different browsers, you can either use a tablet or mobile on your internal network or use a browser plugin like User-Agent switcher for Chrome or Firefox.</p></div>
<p class="indent">Although the filter does its job it is far from complete not to mention the mobile devices that don’t match the rules (for instance the Kindle Fire has a different header then a normal Kindle device). It is also quite hard to maintain the list of rules and devices or to test with many devices. Using a library, like Spring Mobile,<a id="cXXX.2208" class="calibre5"></a> is much easier than to roll your own.</p>
<p id="Sec5" class="Heading">Recipe 8-2. Device detection with Spring Mobile</p>
<p id="Sec6" class="Heading1">Problem</p>
<p class="noindent">You want to detect the type of device that connects to your website and want to use Spring Mobile to help you with this.</p>
<p id="Sec7" class="Heading1">Solution</p>
<p class="noindent">Use the Spring Mobile DeviceResolver and helper classes to determine the type of device by either configuring the <span class="FontName">DeviceResolverRequestFilter</span> or <span class="FontName">DeviceResolverHandlerInterceptor</span>.</p>
<p id="Sec8" class="Heading1">How It Works</p>
<p class="noindent">Both the <span class="FontName">DeviceResolverRequestFilter</span> and the <span class="FontName">DeviceResolverHandlerInterceptor</span> delegate detection of the type of device to a <span class="FontName">DeviceResolver</span>. Spring Mobile provides an implementation of that interface named the <span class="FontName">LiteDeviceResolver</span>. The <span class="FontName">DeviceResolver</span> returns a <span class="FontName">Device</span> object which indicates the type, this <span class="FontName">Device</span> is stored as a request attribute so that it can be used further down the chain.  Spring Mobile comes with a single default implementation of the <span class="FontName">Device</span> interface, <span class="FontName">LiteDevice</span>.</p>
<p id="Sec9" class="Heading2">Using the DeviceResolverRequestFilter</p>
<p class="noindent">To use the <span class="FontName">DeviceResolverRequestFilter</span> is a matter of adding it to the web application and mapping it to the servlet or requests that you want it to handle. For your application that means adding it to the <span class="FontName">getServletFilters</span> method.</p>
<p class="indent">The advantage of using this filter is that it is possible to use it even outside a Spring based application. It could also be used in a, for instance, JSF based application.</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.mobile.web;</span><br class="calibre10"/><span class="FontName">...</span><br class="calibre10"/><span class="FontName">import org.springframework.mobile.device.</span><span class="FontName">DeviceResolverRequestFilter</span><span class="FontName">;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">public class MobileApplicationInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {</span><br class="calibre10"/><span class="FontName">...</span><br class="calibre10"/>    <span class="FontName">@Override</span><br class="calibre10"/>    <span class="FontName">protected Filter[] getServletFilters() {</span><br class="calibre10"/>        <span class="FontName">return new Filter[] {new</span> <b class="calibre4">DeviceResolverRequestFilter</b><span class="FontName">()};</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">This configuration registers the DeviceResolverRequestFilter and will automatically attach it to requests handled by the <span class="FontName">DispatcherServlet</span>.</p>
<p class="indent">To test issue a request to <span class="FontName">http://localhost:8080/mobile/home</span>, which should display something like the following:</p>
<p class="img1"><img src="../images/00065.jpeg" alt="9781430259084_unFig08-01.jpg" class="calibre3"/></p>
<p class="indent">The output for the device is the text as created for the <span class="FontName">toString</span> method on the <span class="FontName">LiteDevice</span> class provided by Spring Mobile.</p>
<p id="Sec10" class="Heading2">Using the DeviceResolverHandlerInterceptor</p>
<p class="noindent">When using Spring Mobile in a Spring MVC based application it is easier to work with the <span class="FontName">DeviceResolverHandlerInterceptor</span>. This needs to be configured in your configuration class and needs to be registered with the <span class="FontName">addInterceptors</span> helper method.</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.mobile.web.config;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import org.springframework.mobile.device.DeviceResolverHandlerInterceptor;</span><br class="calibre10"/><span class="FontName">import org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br class="calibre10"/><span class="FontName">import org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">@Configuration</span><br class="calibre10"/><span class="FontName">@EnableWebMvc</span><br class="calibre10"/><span class="FontName">@ComponentScan("com.apress.springrecipes.mobile.web")</span><br class="calibre10"/><span class="FontName">public class MobileConfiguration extends WebMvcConfigurerAdapter {</span><br class="calibre10"/><span class="FontName">...</span><br class="calibre10"/>    <span class="FontName">@Override</span><br class="calibre10"/>    <span class="FontName">public void addInterceptors(InterceptorRegistry registry) {</span><br class="calibre10"/>        <span class="FontName">registry.addInterceptor(new DeviceResolverHandlerInterceptor());</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">The <span class="FontName">MobileConfiguration</span><a id="cXXX.609" class="calibre5"></a> class extends <span class="FontName">WebMvcConfigurerAdapter</span> from this class we can override the <span class="FontName">addInterceptors</span> method. All the interceptors added to the registry will be added to the <span class="FontName">HandlerMapping</span> beans in the application context. When the application is deployed and a request is done for <span class="FontName">http://localhost:8080/mobile/home</span> the result should be the same as for the filter.</p>
<p id="Sec11" class="Heading">8-3. Using Site preferences<a id="cXXX.610" class="calibre6"></a></p>
<p id="Sec12" class="Heading1">Problem</p>
<p class="noindent">You want to allow the user to choose which type of site they visit with their device and store this for future reference.</p>
<p id="Sec13" class="Heading1">Solution</p>
<p class="noindent">Use the <span class="FontName">SitePreference</span> support provided by Spring Mobile.</p>
<p id="Sec14" class="Heading1">How It Works</p>
<p class="noindent">Both the <span class="FontName">SitePreferenceRequestFilter</span> and the <span class="FontName">SitePreferenceHandlerInterceptor</span> delegate retrieval of the current SitePreference to a <span class="FontName">SitePreferenceHandler</span>. The default implementation uses a <span class="FontName">SitePreferenceRepository</span> to store the preferences, by default this is done in a cookie.</p>
<p id="Sec15" class="Heading2">Using the SitePreferenceRequestFilter</p>
<p class="noindent">To use the <span class="FontName">SitePreferenceRequestFilter</span> is a matter of adding it to the web application and mapping it to the servlet or requests that you want it to handle. For your application that means adding it to the <span class="FontName">getServletFilters</span> method.</p>
<p class="indent">The advantage of using a filter is that it is possible to use it even outside a Spring based application. It could also be used in a, JSF-based application.</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.mobile.web;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import org.springframework.mobile.device.site.SitePreferenceRequestFilter;</span><br class="calibre10"/><span class="FontName">...</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">public class MobileApplicationInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@Override</span><br class="calibre10"/>    <span class="FontName">protected Filter[] getServletFilters() {</span><br class="calibre10"/>        <span class="FontName">return new Filter[] {</span><br class="calibre10"/>                <span class="FontName">new DeviceResolverRequestFilter(),</span><br class="calibre10"/>                <b class="calibre4">new SitePreferenceRequestFilter()};</b><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">...</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">Now that the <span class="FontName">SitePreferenceRequestFilter</span> is registered it will inspect incoming requests. If a request has a parameter named <span class="FontName">site_preference</span> it will use the passed in value (NORMAL, MOBILE, or TABLET) to set the SitePreference. The determined value is stored in a cookie and used for future reference, if a new value is detected the cookie value will be reset.</p>
<p class="indent">Modify the home.jsp pages to include the following that will display the current <span class="FontName">SitePreference</span>:</p>
<pre class="calibre11"><span class="FontName">&lt;p&gt;</span><br class="calibre10"/>    <span class="FontName">Your site preferences &lt;c:out</span> <span class="FontName">value</span><span class="FontName">="${requestScope.currentSitePreference}" /&gt;</span><br class="calibre10"/><span class="FontName">&lt;/p&gt;</span></pre>
<p class="indent">When opening the page using the URL <span class="FontName">http://localhost:8080/mobile/home?site_preference=TABLET</span> will set the <span class="FontName">SitePreference</span> to TABLET.</p>
<p class="img1"><img src="../images/00066.jpeg" alt="9781430259084_unFig08-02.jpg" class="calibre3"/></p>
<p id="Sec16" class="Heading2">Using the SitePreferenceHandlerInterceptor</p>
<p class="noindent">When using Spring Mobile in a Spring MVC based application it is easier to work with the <span class="FontName">SitePreferenceHandlerInterceptor</span>. This needs to be configured in your configuration class and needs to be registered with the <span class="FontName">addInterceptors</span> helper method.</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.mobile.web.config;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import org.springframework.mobile.device.DeviceResolverHandlerInterceptor;</span><br class="calibre10"/><span class="FontName">import org.springframework.mobile.device.site.</span> <b class="calibre4">SitePreferenceHandlerInterceptor;</b><br class="calibre10"/><span class="FontName">import org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br class="calibre10"/><span class="FontName">import org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">@Configuration</span><br class="calibre10"/><span class="FontName">@EnableWebMvc</span><br class="calibre10"/><span class="FontName">@ComponentScan("com.apress.springrecipes.mobile.web")</span><br class="calibre10"/><span class="FontName">public class MobileConfiguration extends WebMvcConfigurerAdapter {</span><br class="calibre10"/><span class="FontName">...</span><br class="calibre10"/>    <span class="FontName">@Override</span><br class="calibre10"/>    <span class="FontName">public void addInterceptors(InterceptorRegistry registry) {</span><br class="calibre10"/>        <span class="FontName">registry.addInterceptor(new DeviceResolverHandlerInterceptor());</span><br class="calibre10"/>        <b class="calibre4">registry.addInterceptor(new SitePreferenceHandlerInterceptor());</b><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">The <span class="FontName">MobileConfiguration</span> class extends <span class="FontName">WebMvcConfigurerAdapter</span> from this class we can override the <span class="FontName">addInterceptors</span> method. All the interceptors added to the registry will be added to the <span class="FontName">HandlerMapping</span> beans in the application context. When the application is deployed and a request is done for <span class="FontName">http://localhost:8080/mobile/home?site_preference=TABLET</span> the result should be the same as for the filter in the previous section.</p>
<p id="Sec17" class="Heading">8-4. Using the Device Information to Render Views</p>
<p id="Sec18" class="Heading1">Problem</p>
<p class="noindent">You want to render a different view based on the device or site preferences.</p>
<p id="Sec19" class="Heading1">Solution</p>
<p class="noindent">Use the current <span class="FontName">Device</span> and <span class="FontName">SitePreferences</span> to determine which view to render. This can be done manually or by using the <span class="FontName">LiteDeviceDelegatingViewResolver</span>.</p>
<p id="Sec20" class="Heading1">How It Works</p>
<p class="noindent">Now that the type of <span class="FontName">Device</span> is known it can be used to your advantage. First let’s create some additional views for each type of device supported, put them respectively in a <span class="FontName">mobile</span> and <span class="FontName">tablet</span> directory under<a id="cXXX.611" class="calibre5"></a> <span class="FontName">WEB-INF/views</span>.</p>
<p class="indent">The source for <span class="FontName">mobile/home.jsp</span>:</p>
<pre class="calibre11"><span class="FontName">&lt;%@ taglib uri="</span><span class="FontName"><a href="http://java.sun.com/jsp/jstl/core" class="calibre5">http://java.sun.com/jsp/jstl/core</a></span><span class="FontName">" prefix="c" %&gt;</span><br class="calibre10"/><span class="FontName">&lt;!doctype html&gt;</span><br class="calibre10"/><span class="FontName">&lt;html&gt;</span><br class="calibre10"/><span class="FontName">&lt;body&gt;</span><br class="calibre10"/><br class="calibre10"/><b class="calibre4">&lt;h1&gt;Welcome Mobile User&lt;/h1&gt;</b><br class="calibre10"/><span class="FontName">&lt;p&gt;</span><br class="calibre10"/>    <span class="FontName">Your User-Agent header: &lt;c:out value="${header['User-Agent']}" /&gt;</span><br class="calibre10"/><span class="FontName">&lt;/p&gt;</span><br class="calibre10"/><span class="FontName">&lt;p&gt;</span><br class="calibre10"/>    <span class="FontName">Your type of device: &lt;c:out value="${requestScope.currentDevice}" /&gt;</span><br class="calibre10"/><span class="FontName">&lt;/p&gt;</span><br class="calibre10"/><span class="FontName">&lt;p&gt;</span><br class="calibre10"/>    <span class="FontName">Your site preferences &lt;c:out value="${requestScope.currentSitePreference}" /&gt;</span><br class="calibre10"/><span class="FontName">&lt;/p&gt;</span><br class="calibre10"/><span class="FontName">&lt;/body&gt;</span><br class="calibre10"/><span class="FontName">&lt;/html&gt;</span></pre>
<p class="indent">The <span class="FontName">tablet/home.jsp</span>:</p>
<pre class="calibre11"><span class="FontName">&lt;%@ taglib uri="</span><span class="FontName"><a href="http://java.sun.com/jsp/jstl/core" class="calibre5">http://java.sun.com/jsp/jstl/core</a></span><span class="FontName">" prefix="c" %&gt;</span><br class="calibre10"/><span class="FontName">&lt;!doctype html&gt;</span><br class="calibre10"/><span class="FontName">&lt;html&gt;</span><br class="calibre10"/><span class="FontName">&lt;body&gt;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">&lt;h1&gt;Welcome Tablet User&lt;/h1&gt;</span><br class="calibre10"/><span class="FontName">&lt;p&gt;</span><br class="calibre10"/>    <span class="FontName">Your User-Agent header: &lt;c:out value="${header['User-Agent']}" /&gt;</span><br class="calibre10"/><span class="FontName">&lt;/p&gt;</span><br class="calibre10"/><span class="FontName">&lt;p&gt;</span><br class="calibre10"/>    <span class="FontName">Your type of device: &lt;c:out value="${requestScope.currentDevice}" /&gt;</span><br class="calibre10"/><span class="FontName">&lt;/p&gt;</span><br class="calibre10"/><span class="FontName">&lt;p&gt;</span><br class="calibre10"/>    <span class="FontName">Your site preferences &lt;c:out value="${requestScope.currentSitePreference}" /&gt;</span><br class="calibre10"/><span class="FontName">&lt;/p&gt;</span><br class="calibre10"/><span class="FontName">&lt;/body&gt;</span><br class="calibre10"/><span class="FontName">&lt;/html&gt;</span></pre>
<p class="indent">Now that the different views are in place we need to find a way to render the different views based on the <span class="FontName">Device</span> that has been detected. One way would be to manually get access to the current device from the request and use that to determine which view to render.</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.mobile.web;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import org.springframework.mobile.device.Device;</span><br class="calibre10"/><span class="FontName">import org.springframework.mobile.device.DeviceUtils;</span><br class="calibre10"/><span class="FontName">import org.springframework.stereotype.Controller;</span><br class="calibre10"/><span class="FontName">import org.springframework.web.bind.annotation.RequestMapping;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import javax.servlet.http.HttpServletRequest;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">@Controller</span><br class="calibre10"/><span class="FontName">public class HomeController {</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@RequestMapping("/home")</span><br class="calibre10"/>    <span class="FontName">public String index(HttpServletRequest request) {</span><br class="calibre10"/>        <span class="FontName">Device device = DeviceUtils.getCurrentDevice(request);</span><br class="calibre10"/>        <span class="FontName">if (device.isMobile()) {</span><br class="calibre10"/>            <span class="FontName">return "mobile/home";</span><br class="calibre10"/>        <span class="FontName">} else if (device.isTablet()) {</span><br class="calibre10"/>            <span class="FontName">return "tablet/home";</span><br class="calibre10"/>        <span class="FontName">} else {</span><br class="calibre10"/>            <span class="FontName">return "home";</span><br class="calibre10"/>        <span class="FontName">}</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">Spring Mobile has a <span class="FontName">DeviceUtils</span><a id="cXXX.612" class="calibre5"></a> class that can be used to retrieve the current device.  The current device is retrieved from a request attribute (<span class="FontName">currentDevice</span>) which has been set by the filter or interceptor. The <span class="FontName">Device</span> can be used to determine which view to render.</p>
<p class="indent">Getting the device in each method that needs it isn’t very convenient. It would be a lot easier if it could be passed into the controller method as a method argument. For this there is the <span class="FontName">DeviceHandlerMethodArgumentResolver</span> which can be registered and will resolve the method argument to the current device. To retrieve the current SitePreferences you can add the <span class="FontName">SitePreferenceHandlerMethodArgumentResolver</span>.</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.mobile.web.config;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import org.springframework.mobile.device.DeviceHandlerMethodArgumentResolver;</span><br class="calibre10"/><span class="FontName">...</span><br class="calibre10"/><span class="FontName">import java.util.List;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">@Configuration</span><br class="calibre10"/><span class="FontName">@EnableWebMvc</span><br class="calibre10"/><span class="FontName">@ComponentScan("com.apress.springrecipes.mobile.web")</span><br class="calibre10"/><span class="FontName">public class MobileConfiguration extends WebMvcConfigurerAdapter {</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">...</span><br class="calibre10"/>    <span class="FontName">@Override</span><br class="calibre10"/>    <span class="FontName">public void addArgumentResolvers(List&lt;HandlerMethodArgumentResolver&gt; argumentResolvers) {</span><br class="calibre10"/>        <b class="calibre4">argumentResolvers.add(new DeviceHandlerMethodArgumentResolver());</b><br class="calibre10"/>        <b class="calibre4">argumentResolvers.add(new SitePreferenceHandlerMethodArgumentResolver());</b><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">Now that these have been registered the controller method can be simplified and the <span class="FontName">Device</span> can be passed in as a method argument</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.mobile.web;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import org.springframework.mobile.device.Device;</span><br class="calibre10"/><span class="FontName">import org.springframework.stereotype.Controller;</span><br class="calibre10"/><span class="FontName">import org.springframework.web.bind.annotation.RequestMapping;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import javax.servlet.http.HttpServletRequest;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">@Controller</span><br class="calibre10"/><span class="FontName">public class HomeController {</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@RequestMapping("/home")</span><br class="calibre10"/>    <b class="calibre4">public String index(Device device) {</b><br class="calibre10"/>        <span class="FontName">if (device.isMobile()) {</span><br class="calibre10"/>            <span class="FontName">return "mobile/home";</span><br class="calibre10"/>        <span class="FontName">} else if (device.isTablet()) {</span><br class="calibre10"/>            <span class="FontName">return "tablet/home";</span><br class="calibre10"/>        <span class="FontName">} else {</span><br class="calibre10"/>            <span class="FontName">return "home";</span><br class="calibre10"/>        <span class="FontName">}</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">The method signature changed from having a <span class="FontName">HttpServletRequest</span> to a <span class="FontName">Device</span>. That takes care of the lookup and will pass in the current device. However while this is more convenient then manual retrieval it is still quite an antiquated way to determine which view to render. Currently the preferences aren’t taken into account but this could be added to the method signature as well and could be used to determine the preference. However it would complicate the detection algorithm.</p>
<p class="indent">Imagine this code in multiple controller methods and it will soon become a maintenance nightmare.</p>
<p class="indent">Spring Mobile ships with a <span class="FontName">LiteDeviceDelegatingViewResolver</span><a id="cXXX.613" class="calibre5"></a> which can be used to add additional prefixes and/or suffixes to the view name, before it is passed on to the actual view resolver. It also takes into account the optional site preferences of the user.</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.mobile.web.config;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import org.springframework.mobile.device.view.LiteDeviceDelegatingViewResolver;</span><br class="calibre10"/><span class="FontName">...</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">@Configuration</span><br class="calibre10"/><span class="FontName">@EnableWebMvc</span><br class="calibre10"/><span class="FontName">@ComponentScan("com.apress.springrecipes.mobile.web")</span><br class="calibre10"/><span class="FontName">public class MobileConfiguration extends WebMvcConfigurerAdapter {</span><br class="calibre10"/><span class="FontName">...</span><br class="calibre10"/>    <span class="FontName">@Bean</span><br class="calibre10"/>    <span class="FontName">public ViewResolver viewResolver() {</span><br class="calibre10"/>        <span class="FontName">InternalResourceViewResolver viewResolver = new InternalResourceViewResolver();</span><br class="calibre10"/>        <span class="FontName">viewResolver.setPrefix("/WEB-INF/views/");</span><br class="calibre10"/>        <span class="FontName">viewResolver.setSuffix(".jsp");</span><br class="calibre10"/>        <b class="calibre4">viewResolver.setOrder(2);</b><br class="calibre10"/>        <span class="FontName">return viewResolver;</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@Bean</span><br class="calibre10"/>    <span class="FontName">public ViewResolver mobileViewResolver() {</span><br class="calibre10"/>        <span class="FontName">LiteDeviceDelegatingViewResolver delegatingViewResolver =</span><br class="calibre10"/>            <span class="FontName">new LiteDeviceDelegatingViewResolver(viewResolver());</span><br class="calibre10"/>        <b class="calibre4">delegatingViewResolver.setOrder(1);</b><br class="calibre10"/>        <span class="FontName">delegatingViewResolver.setMobilePrefix("mobile/");</span><br class="calibre10"/>        <span class="FontName">delegatingViewResolver.setTabletPrefix("tablet/");</span><br class="calibre10"/>        <span class="FontName">return delegatingViewResolver;</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">The <span class="FontName">LiteDeviceDelegatingViewResolver</span> takes a delegate view resolver as a constructor argument, the earlier configured <span class="FontName">InternalResourceViewResolver</span> is passed in as the delegate. Also note the ordering of the view resolvers, you have to make sure that the <span class="FontName">LiteDeviceDelegatingViewResolver</span> executes before any other view resolver. This way it has a chance to determine if a custom view for a particular device exists.</p>
<p class="indent">Next notice the configuration as the views for mobile devices are located in the <span class="FontName">mobile</span> directory and for the tablet they are in the <span class="FontName">tablet</span> directory. To add these directories to the view names the prefixes for those device types are set to their respective directories. Now when a controller returns <span class="FontName">home</span> as the view name to select for a mobile device it would be turned into <span class="FontName">mobile/home</span>. This modified name is passed on to the <span class="FontName">InternalResourceViewResolver</span><a id="cXXX.614" class="calibre5"></a> which turns it into <span class="FontName">/WEB-INF/views/mobile/home.jsp</span>, the page we actually want to render.</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.mobile.web;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import org.springframework.stereotype.Controller;</span><br class="calibre10"/><span class="FontName">import org.springframework.web.bind.annotation.RequestMapping;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">@Controller</span><br class="calibre10"/><span class="FontName">public class HomeController {</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@RequestMapping("/home")</span><br class="calibre10"/>    <span class="FontName">public String index() {</span><br class="calibre10"/>        <span class="FontName">return "home";</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">The controller is quite clean now. Its only concern is to return the name of the view. The determination of which view to render is left to the configured view resolvers. The <span class="FontName">LiteDeviceDelegatingViewResolver</span> takes into account any <span class="FontName">SitePreferences</span> when found.</p>
<p id="Sec21" class="Heading">8-5. Site Switching<a id="cXXX.2178" class="calibre6"></a></p>
<p id="Sec22" class="Heading1">Problem</p>
<p class="noindent">Your mobile site is hosted on a different URL then your normal website.</p>
<p id="Sec23" class="Heading1">Solution</p>
<p class="noindent">Use Spring Mobile’s site switching support to redirect to the appropriate part of your website.</p>
<p id="Sec24" class="Heading1">How It Works</p>
<p class="noindent">Spring Mobile comes with a <span class="FontName">SiteSwitcherHandlerInterceptor</span> which you can use to switch to a mobile version of your site based on the detected <span class="FontName">Device</span>. To configure the <span class="FontName">SiteSwitcherHandlerInterceptor</span> there are a couple of factory methods which provide ready to use settings.</p>
<div class="Table" id="Tab1">
<p class="TabCapt"><span class="calibre4"><a class="calibre5">Table 8-1</a>.</span> Overview of factory methods<a id="cXXX.615" class="calibre5"></a> on SiteSwitcherHandlerInterceptor</p>
<table border="0" class="calibre12"><thead class="calibre13"><tr class="header"><th valign="top" class="calibre14">
<p class="tab-left">Factory Method</p></th><th valign="top" class="calibre14">
<p class="tab-left">Description</p></th></tr></thead><tbody class="calibre15"><tr class="noclass"><td valign="top" class="calibre16">
<p class="tab-leftt">mDot</p></td><td valign="top" class="calibre16">
<p class="tab-leftt">Redirects to a domain starting with <span class="FontName">m.</span>, For instance <span class="FontName"><a href="http://www.yourdomain.com" class="calibre5">http://www.yourdomain.com</a></span> would redirect to <span class="FontName">http://</span><b class="calibre4">m.</b><span class="FontName">yourdomain.com</span>.</p></td></tr><tr class="noclass"><td valign="top" class="calibre16">
<p class="tab-leftt">dotMobi</p></td><td valign="top" class="calibre16">
<p class="tab-leftt">Redirects to a domain ending with <span class="FontName">.mobi</span>. A request to <span class="FontName"><a href="http://www.yourdomain.com" class="calibre5">http://www.yourdomain.com</a></span> would redirect to <span class="FontName"><a href="http://www.yourdomain" class="calibre5">http://www.yourdomain</a></span><b class="calibre4">.mobi</b>.</p></td></tr><tr class="noclass"><td valign="top" class="calibre16">
<p class="tab-leftt">urlPath</p></td><td valign="top" class="calibre16">
<p class="tab-leftt">Setup different context roots for different devices. Will redirect to the configured URL path for that device. For instance <span class="FontName"><a href="http://www.yourdomain.com" class="calibre5">http://www.yourdomain.com</a></span> could be redirected to <span class="FontName"><a href="http://www.yourdomain.com" class="calibre5">http://www.yourdomain.com</a></span><b class="calibre4">/mobile</b>.</p></td></tr><tr class="noclass"><td valign="top" class="calibre16">
<p class="tab-leftt">standard</p></td><td valign="top" class="calibre16">
<p class="tab-leftt">Most flexible configurable factory method allows to specify a domain to redirect to for the mobile, tablet and normal version of your website.</p></td></tr></tbody></table>
</div>
<p class="indent">The <span class="FontName">SiteSwitcherHandlerInterceptor</span> also provides the ability to use site preferences. When using the <span class="FontName">SiteSwitcherHandlerInterceptor</span> it isn’t needed to register the <span class="FontName">SitePreferencesHandlerInterceptor</span><a id="cXXX.616" class="calibre5"></a> anymore as this is already taken care of.</p>
<p class="indent">Configuration is as simple as adding it to the list of interceptors you want to apply, the only thing to remember is that you need to place it after the DeviceResolverHandlerInterceptor as the device information is need to calculate the redirect.</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.mobile.web.config;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">...</span><br class="calibre10"/><span class="FontName">import org.springframework.mobile.device.switcher.SiteSwitcherHandlerInterceptor;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">@Configuration</span><br class="calibre10"/><span class="FontName">@EnableWebMvc</span><br class="calibre10"/><span class="FontName">@ComponentScan("com.apress.springrecipes.mobile.web")</span><br class="calibre10"/><span class="FontName">public class MobileConfiguration extends WebMvcConfigurerAdapter {</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@Override</span><br class="calibre10"/>    <span class="FontName">public void addInterceptors(InterceptorRegistry registry) {</span><br class="calibre10"/>        <span class="FontName">registry.addInterceptor(new DeviceResolverHandlerInterceptor());</span><br class="calibre10"/>        <b class="calibre4">registry.addInterceptor(siteSwitcherHandlerInterceptor());</b><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@Bean</span><br class="calibre10"/>    <span class="FontName">public SiteSwitcherHandlerInterceptor siteSwitcherHandlerInterceptor() {</span><br class="calibre10"/>        <span class="FontName">return SiteSwitcherHandlerInterceptor.</span><b class="calibre4">mDot</b><span class="FontName">("yourdomain.com", true);</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">...</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">Notice the bean declaration for the <span class="FontName">SiteSwitcherHandlerInterceptor</span> the factory method <span class="FontName">mDot</span> is used to create an instance. The method takes two arguments the first is the base domain name to use and the second is a b<span class="FontName">oolean</span> indicating whether tablets need to be considered a mobile device the default is <span class="FontName">false</span>. This configuration would lead to redirecting request to the normal website from mobile devices to <span class="FontName">m.yourdomain.com</span>.</p>
<pre class="calibre11"><span class="FontName">@Bean</span><br class="calibre10"/><span class="FontName">public SiteSwitcherHandlerInterceptor siteSwitcherHandlerInterceptor() {</span><br class="calibre10"/>    <span class="FontName">return SiteSwitcherHandlerInterceptor.</span><b class="calibre4">dotMobi</b><span class="FontName">("yourdomain.com", true);</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">The configuration above uses the <span class="FontName">dotMobi</span> factory method<a id="cXXX.617" class="calibre5"></a><a id="cXXX.618" class="calibre5"></a> which takes two arguments. The first is the base domain name to use and the second is a <span class="FontName">boolean</span> indicating if tables are to be considered as mobile device, the default is <span class="FontName">false</span>. This would lead to redirecting request on our normal website from mobile devices to be redirected to <span class="FontName">yourdomain.mobi</span>.</p>
<pre class="calibre11"><span class="FontName">@Bean</span><br class="calibre10"/><span class="FontName">public SiteSwitcherHandlerInterceptor siteSwitcherHandlerInterceptor() {</span><br class="calibre10"/>      <span class="FontName">return SiteSwitcherHandlerInterceptor.</span><b class="calibre4">urlPath</b><span class="FontName">("/mobile", "/tablet", "/home");</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">The configuration above uses the <span class="FontName">urlPath</span> factory method<a id="cXXX.619" class="calibre5"></a> with three arguments. The first argument is the context root for mobile devices, the second the context root for tables. The final argument is the root path or your application. There are two more variations of the <span class="FontName">urlPath</span> factory method: one which only takes only path for mobile devices and another which takes a path for mobile devices and a root path. The configuration above will lead to request from mobile devices to be redirected to <span class="FontName">yourdomain.com</span><b class="calibre4">/home/mobile</b> and for tables to <span class="FontName">yourdomain.com/</span><b class="calibre4">home/tablet.</b></p>
<p class="indent">Finally there is the standard factory method, which is the most flexible and elaborate to configure.</p>
<pre class="calibre11"><span class="FontName">@Bean</span><br class="calibre10"/><span class="FontName">public SiteSwitcherHandlerInterceptor siteSwitcherHandlerInterceptor() {</span><br class="calibre10"/>    <span class="FontName">return SiteSwitcherHandlerInterceptor</span><br class="calibre10"/>                   <span class="FontName">.</span><b class="calibre4">standard</b><span class="FontName">("yourdomain.com", "mobile.yourdomain.com",</span><br class="calibre10"/>                                   <span class="FontName">"tablet.yourdomain.com", "*.yourdomain.com");</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">The configuration above uses the <span class="FontName">standard</span> factory method<a id="cXXX.620" class="calibre5"></a><a id="cXXX.621" class="calibre5"></a>. It specifies a different domain for the normal, mobile, and tables versions of the website. Finally it specifies the domain name of the cookie to use for storing the site preferences. This is needed because of the different subdomains specified.</p>
<p class="indent">There are several other variations of the <span class="FontName">standard</span> factory method which allow for a subset of configuration of what is shown above.</p>
<p id="Sec25" class="Heading">Summary</p>
<p class="noindent">In this chapter you learned how to use Spring Mobile. It can be used to detect the device that is requesting a page or to allow the user to select a certain page based on preferences.</p>
<p class="indent">You learned how you can detect the users device using the <span class="FontName">DeviceResolverRequestFilter</span> or <span class="FontName">DeviceResolverHandlerInterceptor</span>. You also learned how you can use <span class="FontName">SitePreferences</span> to allow the user to override the detected <span class="FontName">Device</span>.</p>
<p class="indent">Next you looked at how you can use the device information and preferences to render a view for that device.</p>
<p class="indent">Finally you learned how to redirect the user to a different part of your website based on their device or site preferences.</p>
<p class="indent">In the next chapter you will explore how to integrate Spring with other frameworks like JSF.</p></div>
</body></html>
