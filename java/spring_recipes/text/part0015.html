<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Chapter 5 Spring REST</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre"><p class="ChapterNumber"><a id="cXXX.455" class="calibre6"></a><a id="b9781430259084_5" class="calibre6"></a>CHAPTER 5</p>
<p class="Chapimage"><img src="../images/00008.jpeg" alt="image" class="calibre3"/></p>
<p class="ChapterTitle">Spring REST</p>
<div class="calibre10"><p class="noindent">In this chapter, you will learn how Spring addresses Representational State Transfer<a id="cXXX.2155" class="calibre5"></a>, usually referred to by its acronym REST. REST has had an important impact on web applications since the term was coined by Roy Fielding (<span class="FontName"><a href="http://en.wikipedia.org/wiki/Roy_Fielding" class="calibre5">http://en.wikipedia.org/wiki/Roy_Fielding</a></span>) in the year 2000.</p>
<p class="indent">Based on the foundations of the web’s protocol Hypertext Transfer Protocol (HTTP)<a id="cXXX.456" class="calibre5"></a>, the architecture set forth by REST has become increasingly popular in the implementation of web services.</p>
<p class="indent">Web services in and of themselves have become the cornerstone for much machine-to-machine communication<a id="cXXX.457" class="calibre5"></a> taking place on the Web. It’s the fragmented technology choices (e.g., Java, Python, Ruby, .NET) made by many organizations that have necessitated a solution capable of bridging the gaps between these disparate environments. How is information in an application backed by Java accessed by one written in Python? How can a Java application obtain information from an application written in .NET? Web services fill this void.</p>
<p class="indent">There are various approaches to implementing web services<a id="cXXX.458" class="calibre5"></a>, but RESTful web services have become the most common choice in web applications. They are used by some of the largest Internet portals (e.g., Google and Yahoo) to provide access to their information, used to back access to Ajax calls made by browsers, in addition to providing the foundations for the distribution of information like news feeds (e.g., RSS).</p>
<p class="indent">In this chapter, you will learn how Spring applications can use REST, so you can both access and provide information using this popular approach.</p>
<p id="Sec1" class="Heading">5-1. Publishing XML<a id="cXXX.459" class="calibre6"></a> with REST Services</p>
<p id="Sec2" class="Heading1">Problem</p>
<p class="noindent">You want to publish a XML based REST service with Spring.</p>
<p id="Sec3" class="Heading1">Solution</p>
<p class="noindent"><a id="cXXX.460" class="calibre5"></a>There are two possibilities when designing REST services in Spring. One involves <i class="calibre8">publishing</i> an application’s data as a REST service, the other one involves <i class="calibre8">accessing</i> data from third-party REST services to be used in an application. This recipe describes how to publish an application’s data as a REST service. Recipe 5-2 describes how to access data from third-party REST services.</p>
<p class="indent">Publishing an application’s data as a REST service revolves around the use of the Spring MVC annotations <span class="FontName">@RequestMapping</span> and <span class="FontName">@PathVariable</span>. By using these annotations to decorate a Spring MVC handler method, a Spring application is capable of publishing an application's data as a REST service.</p>
<p class="indent">In addition, Spring supports a series of mechanisms to generate a REST service’s payload. This recipe will explore the simplest mechanism, which involves the use of Spring’s <span class="FontName">MarshallingView</span> class. As the recipes in this chapter progress, you will learn about more advanced mechanisms supported by Spring to generate REST service payloads.</p>
<p id="Sec4" class="Heading1">How It Works</p>
<p class="noindent">Publishing a web application’s data as a REST service, or as it's more technically known in web services parlance “creating an end point,” is strongly tied to Spring MVC, which you explored in <a href="part0014.html" class="calibre5">Chapter 4</a>.</p>
<p class="indent">Since Spring MVC relies on the annotation <span class="FontName">@RequestMapping</span> to decorate handler methods and define access points (i.e., URLs), it’s the preferred way in which to define a REST service’s end point.</p>
<p id="Sec5" class="Heading2">Using a MarshallingView to produce XML</p>
<p class="noindent">The following listing illustrates a Spring MVC controller class with a handler method<a id="cXXX.461" class="calibre5"></a> that defines a REST service endpoint:</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.court.web;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import com.apress.springrecipes.court.domain.Members;</span><br class="calibre10"/><span class="FontName">import com.apress.springrecipes.court.service.MemberService;</span><br class="calibre10"/><span class="FontName">import org.springframework.beans.factory.annotation.Autowired;</span><br class="calibre10"/><span class="FontName">import org.springframework.stereotype.Controller;</span><br class="calibre10"/><span class="FontName">import org.springframework.ui.Model;</span><br class="calibre10"/><span class="FontName">import org.springframework.web.bind.annotation.RequestMapping;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">@Controller</span><br class="calibre10"/><span class="FontName">public class RestMemberController {</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">private final MemberService memberService;</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@Autowired</span><br class="calibre10"/>    <span class="FontName">public RestMemberController(MemberService memberService) {</span><br class="calibre10"/>        <span class="FontName">super();</span><br class="calibre10"/>        <span class="FontName">this.memberService=memberService;</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@RequestMapping("/members")</span><br class="calibre10"/>    <span class="FontName">public String getRestMembers(Model model) {</span><br class="calibre10"/>        <span class="FontName">Members members = new Members();</span><br class="calibre10"/>        <span class="FontName">members.addMembers(memberService.findAll());</span><br class="calibre10"/>        <span class="FontName">model.addAttribute("members", members);</span><br class="calibre10"/>        <span class="FontName">return "membertemplate";</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">By using <span class="FontName">@RequestMapping("/members")</span> to decorate a controller’s handler method, a REST service endpoint is made accessible at <span class="FontName">http://[host_name]/[app-name]/members</span>.  You can observe that control is relinquished to a logical view named <span class="FontName">membertemplate</span>. The following listing illustrates the declaration used to define the logical view named <span class="FontName">membertemplate</span><a id="cXXX.462" class="calibre5"></a>:</p>
<pre class="calibre11"><span class="FontName">@Configuration</span><br class="calibre10"/><span class="FontName">@EnableWebMvc</span><br class="calibre10"/><span class="FontName">@ComponentScan(basePackages = "com.apress.springrecipes.court.web")</span><br class="calibre10"/><span class="FontName">public class CourtRestConfiguration {</span><br class="calibre10"/><br class="calibre10"/>    <b class="calibre4">@Bean</b><br class="calibre10"/>    <b class="calibre4">public View membertemplate() {</b><br class="calibre10"/>        <b class="calibre4">return new MarshallingView(jaxb2Marshaller());</b><br class="calibre10"/>    <b class="calibre4">}</b><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@Bean</span><br class="calibre10"/>    <span class="FontName">public Marshaller jaxb2Marshaller() {</span><br class="calibre10"/>        <span class="FontName">Jaxb2Marshaller marshaller = new Jaxb2Marshaller();</span><br class="calibre10"/>        <span class="FontName">marshaller.setClassesToBeBound(Members.class, Member.class);</span><br class="calibre10"/>        <span class="FontName">return marshaller;</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@Bean</span><br class="calibre10"/>    <span class="FontName">public ViewResolver viewResolver() {</span><br class="calibre10"/>        <span class="FontName">return new BeanNameViewResolver();</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@Bean</span><br class="calibre10"/>    <span class="FontName">public MemberService memberService() {</span><br class="calibre10"/>        <span class="FontName">return new InMemoryMemberService();</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span><br class="calibre10"/></pre>
<p class="indent">The <span class="FontName">membertemplate</span> view is defined as a <span class="FontName">MarshallingView</span> type, which is a general-purpose class that allows a response to be rendered using a marshaller. Marshalling is the process of transforming an in-memory representation of an object into a data format. Therefore, for this particular case, a marshaller is charged with transforming <span class="FontName">Members</span> and <span class="FontName">Member</span> objects into an XML data format.</p>
<p class="indent">The marshaller used by <span class="FontName">MarshallingView</span> belongs to one of a series of XML marshallers provided by Spring—<span class="FontName">Jaxb2Marshaller</span><a id="cXXX.463" class="calibre5"></a>. Other marshallers provided by Spring include <span class="FontName">CastorMarshaller</span>, <span class="FontName">JibxMarshaller</span>, <span class="FontName">XmlBeansMarshaller</span>, and <span class="FontName">XStreamMarshaller</span>.</p>
<p class="indent">Marshallers themselves also require configuration. We opted to use the <span class="FontName">Jaxb2Marshaller</span> marshaller due to its simplicity and <a id="cXXX.464" class="calibre5"></a>Java Architecture for XML Binding (JAXB)<a id="cXXX.465" class="calibre5"></a> foundations. However, if you’re more comfortable using the Castor XML framework, you might find it easier to use the <span class="FontName">CastorMarshaller</span>, and you would likely find it easier to use the <span class="FontName">XStreamMarshaller</span> if your more at ease using XStream, with the same case applying for the rest of the available marshallers.</p>
<p class="indent">The <span class="FontName">Jaxb2Marshaller</span> marshaller requires to be configured with either a property named <span class="FontName">classesToBeBound</span> or <span class="FontName">contextPath</span>. In the case of <span class="FontName">classesToBeBound</span>, the classes assigned to this property, indicate the class (i.e., object) structure that is to be transformed into XML. The following listing illustrates the <span class="FontName">Members</span> and <span class="FontName">Member</span> classes assigned to the <span class="FontName">Jaxb2Marshaller</span>:</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.court.domain;</span><br class="calibre10"/><br class="calibre10"/><b class="calibre4">import javax.xml.bind.annotation.XmlRootElement;</b><br class="calibre10"/><br class="calibre10"/><b class="calibre4">@XmlRootElement</b><br class="calibre10"/><span class="FontName">public class Member {</span><br class="calibre10"/>    <span class="FontName">private String name;</span><br class="calibre10"/>    <span class="FontName">private String phone;</span><br class="calibre10"/>    <span class="FontName">private String email;</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">public String getEmail() {</span><br class="calibre10"/>        <span class="FontName">return email;</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">public String getName() {</span><br class="calibre10"/>        <span class="FontName">return name;</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">public String getPhone() {</span><br class="calibre10"/>        <span class="FontName">return phone;</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">public void setEmail(String email) {</span><br class="calibre10"/>        <span class="FontName">this.email = email;</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">public void setName(String name) {</span><br class="calibre10"/>        <span class="FontName">this.name = name;</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">public void setPhone(String phone) {</span><br class="calibre10"/>        <span class="FontName">this.phone = phone;</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">The Members class:</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.court.domain;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import javax.xml.bind.annotation.XmlAccessType;</span><br class="calibre10"/><span class="FontName">import javax.xml.bind.annotation.XmlAccessorType;</span><br class="calibre10"/><span class="FontName">import javax.xml.bind.annotation.XmlElement;</span><br class="calibre10"/><span class="FontName">import javax.xml.bind.annotation.XmlRootElement;</span><br class="calibre10"/><span class="FontName">import java.util.ArrayList;</span><br class="calibre10"/><span class="FontName">import java.util.Collection;</span><br class="calibre10"/><span class="FontName">import java.util.List;</span><br class="calibre10"/><br class="calibre10"/><br class="calibre10"/><span class="FontName">@XmlRootElement</span><br class="calibre10"/><span class="FontName">@XmlAccessorType(XmlAccessType.FIELD)</span><br class="calibre10"/><span class="FontName">public class Members {</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@XmlElement(name="member")</span><br class="calibre10"/>    <span class="FontName">private List&lt;Member&gt; members = new ArrayList&lt;&gt;();</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">public List&lt;Member&gt; getMembers() {</span><br class="calibre10"/>        <span class="FontName">return members;</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">public void setMembers(List&lt;Member&gt; members) {</span><br class="calibre10"/>        <span class="FontName">this.members = members;</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">public void addMembers(Collection&lt;Member&gt; members) {</span><br class="calibre10"/>        <span class="FontName">this.members.addAll(members);</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">Note the <span class="FontName">Member</span> class is a POJO decorated with the <span class="FontName">@XmlRootElement</span> annotation. This annotation allows the <span class="FontName">Jaxb2Marshaller</span> marshaller to detect a class’s (i.e., object’s) fields and transform them into XML data (e.g., <span class="FontName">name=John</span> into <span class="FontName">&lt;name&gt;john&lt;/name&gt;</span>, <span class="FontName">email=</span><span class="FontName"><a href="mailto:john@doe.com" class="calibre5">john@doe.com</a></span> into <span class="FontName">&lt;email&gt;</span><span class="FontName"><a href="mailto:john@doe.com" class="calibre5">john@doe.com</a></span><span class="FontName">&lt;/email&gt;</span>).</p>
<p class="indent">To recap what’s been described, this means that when a request is made to a URL in the form <span class="FontName">http://[host_name]//app-name]/members.xml</span>, the corresponding handler is charged with creating a <span class="FontName">Members</span> object, which is then passed to a logical view named <span class="FontName">membertemplate</span>. Based on this last view’s definition, a marshaller is used to convert a <span class="FontName">Members</span> object into an XML payload that is returned to the REST service’s requesting party. The XML payload<a id="cXXX.466" class="calibre5"></a> returned by the REST service is illustrated in the following listing:</p>
<pre class="calibre11"><span class="FontName">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span><br class="calibre10"/><span class="FontName">&lt;members&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;member&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;email&gt;marten@deinum.biz&lt;/email&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;name&gt;Marten Deinum&lt;/name&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;phone&gt;00-31-1234567890&lt;/phone&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;/member&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;member&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;email&gt;</span><span class="FontName"><a href="mailto:john@doe.com" class="calibre5">john@doe.com</a></span><span class="FontName">&lt;/email&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;name&gt;John Doe&lt;/name&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;phone&gt;1-800-800-800&lt;/phone&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;/member&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;member&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;email&gt;</span><span class="FontName"><a href="mailto:jane@doe.com" class="calibre5">jane@doe.com</a></span><span class="FontName">&lt;/email&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;name&gt;Jane Doe&lt;/name&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;phone&gt;1-801-802-803&lt;/phone&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;/member&gt;</span><br class="calibre10"/><span class="FontName">&lt;/members&gt;</span></pre>
<p class="indent">This last XML payload represents a very simple approach to generating a REST service’s response. As the recipes in this chapter progress, you will learn more sophisticated approaches, such as the ability to create widely used REST service payloads like RSS, Atom, and JSON.<a id="cXXX.2156" class="calibre5"></a></p>
<p class="indent">If you look closely at the REST service end point or URL described in the previous paragraph, you’ll note that it has an <span class="FontName">.xml</span> extension. If you try another extension—or even omit the extension—this particular REST service may not be triggered. This last behavior is directly tied to Spring MVC and how it handles view resolution. It has nothing do with REST services per se.</p>
<p class="indent">By default, since the view associated with this particular REST service handler method returns XML, it’s triggered by an <span class="FontName">.xml</span> extension. This allows the same handler method to support multiple views. For example, it can be convenient for a request like <span class="FontName">http://[host_name]/[app-name]/members.pdf</span> to return the same information in a PDF document, as well as a request like <span class="FontName">http://[host_name]/[app-name]/members.html</span> to return content in HTML or a request like <span class="FontName">http://[host_name]/[app-name]/members.xml</span> to return XML for a REST request.</p>
<p class="indent">So what happens to a request with no URL extension<a id="cXXX.467" class="calibre5"></a>, like <span class="FontName">http://[host_name]/[app-name]/members</span>? This also depends heavily on Spring MVC view resolution. For this purpose, Spring MVC supports a process called <i class="calibre8">content negotiation</i><a id="cXXX.468" class="calibre5"></a>, by which a view is determined based on a request’s extension or HTTP headers.</p>
<p class="indent">Since REST service requests typically have HTTP headers in the form <span class="FontName">Accept: application/xml</span>, Spring MVC configured to use content negotiation can determine to serve XML (REST) payloads to such requests even if requests are made extensionless. This also allows extensionless requests to be made in formats like HTML, PDF, and XLS, all simply based on HTTP headers. Recipe 4-7 in <a href="part0014.html" class="calibre5">Chapter 4</a> discusses content negotiation.</p>
<p id="Sec6" class="Heading2">Using @ResponseBody<a id="cXXX.469" class="calibre6"></a> to produce XML</p>
<p class="noindent">Using a MarshallingVie<a id="cXXX.2040" class="calibre5"></a> to produce XML is one way of producing results, however when you want to have multiple representations (JSON for instance) of the same data (a list of Member objects) adding another view can be a cumbersome task. Instead we can rely on the Spring MVC <span class="FontName">HttpMessageConverter</span>s to convert an object to the representation requested by the user.  The following listing shows the changes made to the <span class="FontName">RestMemberController</span>:</p>
<pre class="calibre11"><span class="FontName">@Controller</span><br class="calibre10"/><span class="FontName">public class RestMemberController {</span><br class="calibre10"/><span class="FontName">...</span><br class="calibre10"/>    <span class="FontName">@RequestMapping("/members")</span><br class="calibre10"/>    <b class="calibre4">@ResponseBody</b><br class="calibre10"/>    <span class="FontName">public</span> <b class="calibre4">Members</b> <span class="FontName">getRestMembers() {</span><br class="calibre10"/>        <span class="FontName">Members members = new Members();</span><br class="calibre10"/>        <span class="FontName">members.addMembers(memberService.findAll());</span><br class="calibre10"/>        <span class="FontName">return members;</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">The first change is that we have now, additionally, annotated our controller method with <span class="FontName">@ResponseBody</span>. This annotation tells Spring MVC that the result of the method should be used as the body of the response. As we want XML this marshaling is done by the <span class="FontName">Jaxb2RootElementHttpMessageConverter</span> provided by Spring. The second change is that, due to the <span class="FontName">@ResponseBody</span> annotation, we don’t need the view name anymore but can simply return the <span class="FontName">Members</span> object.</p>
<div class="notepara">
<p class="paraaftertitle"><img src="../images/00016.jpeg" alt="Image" class="calibre3"/> <b class="calibre4">Tip</b>  When using Spring 4 instead of annotation the method with <span class="FontName">@ResponseBody</span> you can also annotate your controller with <span class="FontName">@RestController</span> instead of <span class="FontName">@Controller</span> which would give the same result. This is especially convenient if you have a single controller with multiple methods.</p></div>
<p class="indent">These changes also allow us to clean up our configuration, as we don’t need the <span class="FontName">MarshallingView</span> and <span class="FontName">Jaxb2Marshaller</span> anymore.</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.court.web.config;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import com.apress.springrecipes.court.service.InMemoryMemberService;</span><br class="calibre10"/><span class="FontName">import com.apress.springrecipes.court.service.MemberService;</span><br class="calibre10"/><span class="FontName">import org.springframework.context.annotation.Bean;</span><br class="calibre10"/><span class="FontName">import org.springframework.context.annotation.ComponentScan;</span><br class="calibre10"/><span class="FontName">import org.springframework.context.annotation.Configuration;</span><br class="calibre10"/><span class="FontName">import org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">@Configuration</span><br class="calibre10"/><span class="FontName">@EnableWebMvc</span><br class="calibre10"/><span class="FontName">@ComponentScan(basePackages = "com.apress.springrecipes.court.web")</span><br class="calibre10"/><span class="FontName">public class CourtRestConfiguration {</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@Bean</span><br class="calibre10"/>    <span class="FontName">public MemberService memberService() {</span><br class="calibre10"/>        <span class="FontName">return new InMemoryMemberService();</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">When the application is deployed and you do request the members from <span class="FontName">http://localhost:8080/court/members.xml</span> is will yield the same results as before.</p>
<pre class="calibre11"><span class="FontName">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span><br class="calibre10"/><span class="FontName">&lt;members&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;member&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;email&gt;marten@deinum.biz&lt;/email&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;name&gt;Marten Deinum&lt;/name&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;phone&gt;00-31-1234567890&lt;/phone&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;/member&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;member&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;email&gt;</span><span class="FontName"><a href="mailto:john@doe.com" class="calibre5">john@doe.com</a></span><span class="FontName">&lt;/email&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;name&gt;John Doe&lt;/name&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;phone&gt;1-800-800-800&lt;/phone&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;/member&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;member&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;email&gt;</span><span class="FontName"><a href="mailto:jane@doe.com" class="calibre5">jane@doe.com</a></span><span class="FontName">&lt;/email&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;name&gt;Jane Doe&lt;/name&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;phone&gt;1-801-802-803&lt;/phone&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;/member&gt;</span><br class="calibre10"/><span class="FontName">&lt;/members&gt;</span></pre>
<p id="Sec7" class="Heading2">Using @PathVariable<a id="cXXX.470" class="calibre6"></a> to limit the results</p>
<p class="noindent">It’s common for REST service requests to have parameters. This is done to limit or filter a service’s payload. For example, a request in the form <span class="FontName">http://[host_name]/[app-name]/member/353/</span> can be used to retrieve information exclusively on member <span class="FontName">353</span>. Another variation can be a request like <span class="FontName">http://[host_name]/[app-name]/reservations/07-07-2010/</span> to retrieve reservations made on the date <span class="FontName">07-07-2010</span>.</p>
<p class="indent">In order to use parameters for constructing a REST service in Spring, you use the <span class="FontName">@PathVariable</span> annotation. The <span class="FontName">@PathVariable</span> annotation is added as an input parameter to the handler method, per Spring’s MVC conventions, in order for it to be used inside the handler method body. The following snippet illustrates a handler method for a REST service using the <span class="FontName">@PathVariable</span> annotation.</p>
<pre class="calibre11"><span class="FontName">Import org.springframework.web.bind.annotation.PathVariable;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">@Controller</span><br class="calibre10"/><span class="FontName">public class RestMemberController {</span><br class="calibre10"/><span class="FontName">...</span><br class="calibre10"/>    <span class="FontName">@RequestMapping("/member/{memberid}")</span><br class="calibre10"/>    <span class="FontName">@ResponseBody</span><br class="calibre10"/>    <span class="FontName">public Member getMember(@PathVariable("memberid") long memberID) {</span><br class="calibre10"/>        <span class="FontName">return memberService.find(memberID);</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">Notice the <span class="FontName">@RequestMapping</span> value contains <span class="FontName">{memberid}</span>. Values surrounded by <span class="FontName">{ }</span> are used to indicate URL parameters are variables. Further note the handler method is defined with the input parameter <span class="FontName">@PathVariable("memberid") long memberID</span>. This last declaration associates whatever <span class="FontName">memberid</span> value forms part of the URL and assigns it to a variable named <span class="FontName">memberID</span> that can be accessible inside the handler method.</p>
<p class="indent">Therefore, REST end points in the form <span class="FontName">/member/353/</span> and <span class="FontName">/member/777/</span> will be processed by this last handler method, with the <span class="FontName">memberID</span> variable being assigned values of <span class="FontName">353</span> and <span class="FontName">777</span>, respectively. Inside the handler method, the appropriate queries can be made for members <span class="FontName">353</span> and <span class="FontName">777</span>—via the <span class="FontName">memberID</span> variable—and returned as the REST service’s payload.</p>
<p class="indent">A request to <span class="FontName">http://localhost:8080/court/member/2</span> will result in a XML representation of the member with id 2.</p>
<pre class="calibre11"><span class="FontName">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span><br class="calibre10"/><span class="FontName">&lt;member&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;email&gt;</span><span class="FontName"><a href="mailto:john@doe.com" class="calibre5">john@doe.com</a></span><span class="FontName">&lt;/email&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;name&gt;John Doe&lt;/name&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;phone&gt;1-800-800-800&lt;/phone&gt;</span><br class="calibre10"/><span class="FontName">&lt;/member&gt;</span></pre>
<p class="indent">In addition to supporting the <span class="FontName">{ }</span> notation, it’s also possible to use a wildcard <span class="FontName">*</span> notation for defining REST end points. This is often the case when a design team has opted to use expressive URLs (often called <i class="calibre8">pretty URLs</i>) or opts to use search engine optimization (SEO) techniques to make a REST URL search engine friendly. The following snippet illustrates a declaration for a REST service using the wildcard notation.</p>
<pre class="calibre11"><span class="FontName">@RequestMapping(</span><b class="calibre4">"/member/*/{memberid}"</b><span class="FontName">)</span><br class="calibre10"/><span class="FontName">@ResponseBody</span><br class="calibre10"/><span class="FontName">public Member getMember(@PathVariable("memberid") long memberID) { ... }</span></pre>
<p class="indent">In this case, the addition of a wildcard doesn’t have any influence over the logic performed by the REST service. But it will match end point requests in the form <span class="FontName">/member/John+Smith/353/</span> and <span class="FontName">/member/Mary+Jones/353/</span>, which can have an important impact on end user readability or SEO.</p>
<p class="indent">It’s also worth mentioning that data binding can be used in the definition of handler methods for REST end points. The following snippet illustrates a declaration for a REST service using data binding:</p>
<pre class="calibre11"><span class="FontName">@InitBinder</span><br class="calibre10"/><span class="FontName">public void initBinder(WebDataBinder binder) {</span><br class="calibre10"/>    <span class="FontName">SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd");</span><br class="calibre10"/>    <span class="FontName">binder.registerCustomEditor(Date.class, new CustomDateEditor(dateFormat, false));</span><br class="calibre10"/><span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">@RequestMapping("/reservations/{date}")</span><br class="calibre10"/><span class="FontName">public void getReservation(@PathVariable("date") Date resDate) { ... }</span></pre>
<p class="indent">In this case, a request in the form <span class="FontName">http://[host_name]/[app-name]/reservations/07-07-2010/</span> is matched by this last handler method, with the value <span class="FontName">07-07-2010</span> passed into the handler method—as the variable <span class="FontName">resDate</span>– where it can be used to filter the REST web service payload.</p>
<p id="Sec8" class="Heading2">Using the ResponseEntity<a id="cXXX.471" class="calibre6"></a> to inform the client</p>
<p class="noindent">The endpoint for retrieval of a single <span class="FontName">Member</span> instance either returns a valid member or nothing at all. Both lead to a request which will send a HTTP Response code 200, which means OK, back to the client. However this is probably not what our uses will expect. When working with resources we should inform them of the fact that a resource cannot be found. Ideally we would want to return a HTTP Response Code 404, which indicates not found.  The following code snippets show the modified <span class="FontName">getMember</span> method.</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.court.web;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import org.springframework.http.HttpStatus;</span><br class="calibre10"/><span class="FontName">import org.springframework.http.ResponseEntity;</span><br class="calibre10"/><span class="FontName">...</span><br class="calibre10"/><span class="FontName">@Controller</span><br class="calibre10"/><span class="FontName">public class RestMemberController {</span><br class="calibre10"/><span class="FontName">...</span> <br class="calibre10"/>    <span class="FontName">@RequestMapping("/member/{memberid}")</span><br class="calibre10"/>    <span class="FontName">@ResponseBody</span><br class="calibre10"/>    <span class="FontName">public</span> <b class="calibre4">ResponseEntity&lt;Member&gt;</b> <span class="FontName">getMember(@PathVariable("memberid") long memberID) {</span><br class="calibre10"/>        <span class="FontName">Member member = memberService.find(memberID);</span><br class="calibre10"/>        <span class="FontName">if (member != null) {</span><br class="calibre10"/>            <span class="FontName">return new ResponseEntity&lt;Member&gt;(member, HttpStatus.OK);</span><br class="calibre10"/>        <span class="FontName">}</span><br class="calibre10"/>        <span class="FontName">return new ResponseEntity(HttpStatus.NOT_FOUND);</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">The return value of the method has been changed to <span class="FontName">ResponseEntity&lt;Member&gt;</span>. The <span class="FontName">ResponseEntity</span> is a class in Spring MVC that acts as a wrapper for an object to be used as the body of the result together with a HTTP status code.</p>
<p class="indent">When we find a Member it is returned together with a <span class="FontName">HttpStatus.OK</span>, the latter corresponds to a HTTP status code of 200. When there is no result we return the <span class="FontName">HttpStatus.NOT_FOUND</span>, corresponding to the HTTP Status Code 404, not found.</p>
<p id="Sec9" class="Heading">5-2. Publishing <a id="cXXX.472" class="calibre6"></a>JSON with REST services</p>
<p id="Sec10" class="Heading1">Problem</p>
<p class="noindent">You want to publish a JSON (JavaScript Object Notation)<a id="cXXX.2090" class="calibre5"></a> based REST service with Spring.</p>
<p id="Sec11" class="Heading1">Solution</p>
<p class="noindent">JSON has blossomed into a favorite payload format for REST services. However, unlike most REST service payloads, which rely on XML markup, JSON is different in the sense that its content is a special notation based on the JavaScript language.</p>
<p class="indent">For this recipe, in addition to relying on Spring’s REST support, we will also use the <span class="FontName">MappingJackson2JsonView</span> class that forms part of Spring to facilitate the publication of JSON content.</p>
<div class="notepara">
<p class="paraaftertitle"><img src="../images/00016.jpeg" alt="Image" class="calibre3"/> <b class="calibre4">Note</b>  The <span class="FontName">MappingJackson2JsonView</span> class<a id="cXXX.473" class="calibre5"></a> depends on the presence of the Jackson JSON processor library, version 2, which can be downloaded at <span class="FontName"><a href="http://wiki.fasterxml.com/JacksonDownload" class="calibre5">http://wiki.fasterxml.com/JacksonDownload</a></span>. If you’re using Maven, add the following dependency to your project:</p>
<pre class="calibre19"><span class="FontName1">&lt;dependency&gt;</span><br class="calibre2"/>  <span class="FontName1">&lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br class="calibre2"/>  <span class="FontName1">&lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;</span><br class="calibre2"/>  <span class="FontName1">&lt;version&gt;2.4.0&lt;/version&gt;</span><br class="calibre2"/><span class="FontName1">&lt;/dependency&gt;</span></pre></div>
<div class="Singlethin">
<p class="Heading4a">WHY PUBLISH JSON?</p>
<p class="box-left">If your Spring application’s incorporate Ajax designs, it’s very likely that you’ll find yourself designing REST services that publish JSON as their payload. This is mainly due to the limited processing capabilities in browsers.</p>
<p class="box-left">Although browsers can process and extract information from REST services that publish XML payloads, it’s not very efficient. By instead delivering payloads in JSON, which is based on a language for which browsers have a native interpreter—JavaScript—the processing and extraction of data becomes more efficient.</p>
<p class="box-left">Unlike RSS and Atom feeds, which are standards, JSON has no specific structure it needs to follow—except its syntax which you’ll explore shortly. Therefore, a JSON element’s payload structure is likely to be determined in coordination with the team members charged with an application’s Ajax design.</p></div>
<p id="Sec12" class="Heading1">How It Works</p>
<p class="noindent">The first thing you need to do is determine the information you wish to publish as a JSON payload<a id="cXXX.474" class="calibre5"></a>. This information can be located in a RDBMS or text file, accessed through JDBC or ORM, inclusively be part of a Spring bean or some other type of construct. Describing how to obtain this information would go beyond the scope of this recipe, so we will assume you’ll use whatever means you deem appropriate to access it.</p>
<p class="indent">In case you’re unfamiliar with JSON, the following snippet illustrates a fragment of this format:</p>
<pre class="calibre11"><span class="FontName">{</span><br class="calibre10"/>    <span class="FontName">"glossary": {</span><br class="calibre10"/>        <span class="FontName">"title": "example glossary",</span><br class="calibre10"/>                <span class="FontName">"GlossDiv": {</span><br class="calibre10"/>            <span class="FontName">"title": "S",</span><br class="calibre10"/>                        <span class="FontName">"GlossList": {</span><br class="calibre10"/>                <span class="FontName">"GlossEntry": {</span><br class="calibre10"/>                    <span class="FontName">"ID": "SGML",</span><br class="calibre10"/>                                        <span class="FontName">"SortAs": "SGML",</span><br class="calibre10"/>                                        <span class="FontName">"GlossTerm": "Standard Generalized Markup Language",</span><br class="calibre10"/>                                        <span class="FontName">"Acronym": "SGML",</span><br class="calibre10"/>                                        <span class="FontName">"Abbrev": "ISO 8879:1986",</span><br class="calibre10"/>                                        <span class="FontName">"GlossDef": {</span><br class="calibre10"/>                    <span class="FontName">"para": "A meta-markup language, used to create markup <img src="../images/00053.jpeg" alt="image" class="calibre3"/></span><br class="calibre10"/>                                     <span class="FontName">languages such as DocBook.",</span><br class="calibre10"/>                                                <span class="FontName">"GlossSeeAlso": ["GML", "XML"]</span><br class="calibre10"/>                    <span class="FontName">},</span><br class="calibre10"/>                                                <span class="FontName">"GlossSee": "markup"</span><br class="calibre10"/>                <span class="FontName">}</span><br class="calibre10"/>            <span class="FontName">}</span><br class="calibre10"/>        <span class="FontName">}</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">As you can observe, a JSON payload consists of text and separators like <span class="FontName">{</span> , <span class="FontName">}</span> ,<span class="FontName">[</span> , <span class="FontName">]</span> , <span class="FontName">:</span> and <span class="FontName">"</span>. We won’t go into details about using one separator over another, but it suffices to say this type of syntax makes it easier for a JavaScript engine to access and manipulate data than if it was to process it in an XML type format.</p>
<p id="Sec13" class="Heading2">Using a MappingJackson2JsonView to produce XML</p>
<p class="noindent">Since you’ve already explored how to publish data using a REST service in recipes 5-1 and 5-3, we’ll cut to the chase and show you the actual handler method needed in a Spring MVC controller to achieve this process.</p>
<pre class="calibre11"><span class="FontName">@RequestMapping("/members")</span><br class="calibre10"/><span class="FontName">public String getRestMembers(Model model) {</span><br class="calibre10"/>    <span class="FontName">// Return view jsonmembertemplate. Via resolver the view</span><br class="calibre10"/>    <span class="FontName">// will be mapped to a jackson ObjectMapper bound to the Member class</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">Members members = new Members();</span><br class="calibre10"/>    <span class="FontName">members.addMembers(memberService.findAll());</span><br class="calibre10"/>    <span class="FontName">model.addAttribute("members", members);</span><br class="calibre10"/>    <span class="FontName">return</span> <b class="calibre4">"jsonmembertemplate"</b><span class="FontName">;</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">You probably notice that it is quite similar to the controller method mentioned in Recipe 5-1. The only difference is that we return a different name for the view.  The name of the view we are returning, <b class="calibre4">jsonmembertemplate</b>, is different and maps to a <span class="FontName">MappingJackson2JsonView</span>. This view we need to configure in our configuration class.</p>
<pre class="calibre11"><span class="FontName">@Configuration</span><br class="calibre10"/><span class="FontName">@EnableWebMvc</span><br class="calibre10"/><span class="FontName">@ComponentScan(basePackages = "com.apress.springrecipes.court.web")</span><br class="calibre10"/><span class="FontName">public class CourtRestConfiguration {</span><br class="calibre10"/>    <span class="FontName">...</span><br class="calibre10"/>    <span class="FontName">@Bean</span><br class="calibre10"/>    <span class="FontName">public View jsonmembertemplate() {</span><br class="calibre10"/>        <span class="FontName">MappingJackson2JsonView view = new MappingJackson2JsonView();</span><br class="calibre10"/>        <span class="FontName">view.setPrettyPrint(true);</span><br class="calibre10"/>        <span class="FontName">return view;</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">The <span class="FontName">MappingJackson2JsonView</span> uses the Jackson2 library to convert objects to and from JSON. It uses a Jackson <span class="FontName">ObjectMapper</span> instance for the conversion. When a request is made to <span class="FontName">http://localhost:8080/court/members.json</span> the controller method will be invoked and a JSON representation will be returned.</p>
<pre class="calibre11"><span class="FontName">{</span><br class="calibre10"/>  <span class="FontName">"members" : {</span><br class="calibre10"/>    <span class="FontName">"members" : [ {</span><br class="calibre10"/>      <span class="FontName">"name" : "Marten Deinum",</span><br class="calibre10"/>      <span class="FontName">"phone" : "00-31-1234567890",</span><br class="calibre10"/>      <span class="FontName">"email" : "marten@deinum.biz"</span><br class="calibre10"/>    <span class="FontName">}, {</span><br class="calibre10"/>      <span class="FontName">"name" : "John Doe",</span><br class="calibre10"/>      <span class="FontName">"phone" : "1-800-800-800",</span><br class="calibre10"/>      <span class="FontName">"email" : "</span><span class="FontName"><a href="mailto:john@doe.com" class="calibre5">john@doe.com</a></span><span class="FontName">"</span><br class="calibre10"/>    <span class="FontName">}, {</span><br class="calibre10"/>      <span class="FontName">"name" : "Jane Doe",</span><br class="calibre10"/>      <span class="FontName">"phone" : "1-801-802-803",</span><br class="calibre10"/>      <span class="FontName">"email" : "</span><span class="FontName"><a href="mailto:jane@doe.com" class="calibre5">jane@doe.com</a></span><span class="FontName">"</span><br class="calibre10"/>    <span class="FontName">} ]</span><br class="calibre10"/>  <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">Actually this JSON will be produced by each call to <span class="FontName">/members</span> or <span class="FontName">/members.*</span> (for instance /members.xml will also produce JSON). Let’s add the method and view from Recipe 5-1 to our controller</p>
<pre class="calibre11"><span class="FontName">@Controller</span><br class="calibre10"/><span class="FontName">public class RestMemberController {</span><br class="calibre10"/><span class="FontName">...</span><br class="calibre10"/>    <span class="FontName">@RequestMapping(value="/members",</span> <b class="calibre4">produces=MediaType.APPLICATION_XML_VALUE</b><span class="FontName">)</span><br class="calibre10"/>    <span class="FontName">public String getRestMembersXml(Model model) {</span><br class="calibre10"/>        <span class="FontName">Members members = new Members();</span><br class="calibre10"/>        <span class="FontName">members.addMembers(memberService.findAll());</span><br class="calibre10"/>        <span class="FontName">model.addAttribute("members", members);</span><br class="calibre10"/>        <span class="FontName">return "xmlmembertemplate";</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@RequestMapping(value="/members",</span> <b class="calibre4">produces= MediaType.APPLICATION_JSON_VALUE</b><span class="FontName">)</span><br class="calibre10"/>    <span class="FontName">public String getRestMembersJson(Model model) {</span><br class="calibre10"/>        <span class="FontName">Members members = new Members();</span><br class="calibre10"/>        <span class="FontName">members.addMembers(memberService.findAll());</span><br class="calibre10"/>        <span class="FontName">model.addAttribute("members", members);</span><br class="calibre10"/>        <span class="FontName">return "jsonmembertemplate";</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">We have now a <span class="FontName">getMembersXml</span> and <span class="FontName">getMembersJson</span> method, both are basically the same with this distinction that they return a different view name. Notice the produces attribute on the @RequestMapping annotation this is used to determine which method to call <span class="FontName">/members.xml</span> will now produce XML whereas <span class="FontName">/members.json</span> will produce JSON.</p>
<p class="indent">Although this approach works duplicating all the methods for the different supported view types isn’t a feasible solution for enterprise applications.  We could create a helper method to reduce the duplication but we would still need a lot of boilerplate due to the differences in the <span class="FontName">@RequestMapping</span> annotations.</p>
<p id="Sec14" class="Heading2">Using @ResponseBody<a id="cXXX.475" class="calibre6"></a> to produce JSON</p>
<p class="noindent">Using a <span class="FontName">MappingJackson2JsonView</span> to produce JSON is one way of producing results, however as mentioned in the previous section can be troublesome, especially with multiple supported view types. Instead we can rely on the Spring MVC <span class="FontName">HttpMessageConverter</span>s to convert an object to the representation requested by the user.  The following listing shows the changes made to the <span class="FontName">RestMemberController</span>:</p>
<pre class="calibre11"><span class="FontName">@Controller</span><br class="calibre10"/><span class="FontName">public class RestMemberController {</span><br class="calibre10"/><span class="FontName">...</span><br class="calibre10"/>    <span class="FontName">@RequestMapping("/members")</span><br class="calibre10"/>    <b class="calibre4">@ResponseBody</b><br class="calibre10"/>    <span class="FontName">public</span> <b class="calibre4">Members</b> <span class="FontName">getRestMembers() {</span><br class="calibre10"/>        <span class="FontName">Members members = new Members();</span><br class="calibre10"/>        <span class="FontName">members.addMembers(memberService.findAll());</span><br class="calibre10"/>        <span class="FontName">return members;</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">The first change is that we have now, additionally, annotated our controller method with <span class="FontName">@ResponseBody</span>. This annotation tells Spring MVC that the result of the method should be used as the body of the response. As we want JSON this marshaling is done by the <span class="FontName">Jackson2JsonMessageConverter</span> provided by Spring. The second change is that, due to the <span class="FontName">@ResponseBody</span> annotation, we don’t need the view name anymore but can simply return the <span class="FontName">Members</span> object.</p>
<div class="notepara">
<p class="paraaftertitle"><img src="../images/00016.jpeg" alt="Image" class="calibre3"/> <b class="calibre4">Tip</b>  When using Spring 4 instead of annotation the method with <span class="FontName">@ResponseBody</span> you can also annotate your controller with <span class="FontName">@RestController</span> instead of <span class="FontName">@Controller</span> which would give the same result. This is especially convenient if you have a single controller with multiple methods.</p></div>
<p class="indent">These changes also allow us to clean up our configuration, as we don’t need the <span class="FontName">MappingJackson2JsonView</span> anymore.</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.court.web.config;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import com.apress.springrecipes.court.service.InMemoryMemberService;</span><br class="calibre10"/><span class="FontName">import com.apress.springrecipes.court.service.MemberService;</span><br class="calibre10"/><span class="FontName">import org.springframework.context.annotation.Bean;</span><br class="calibre10"/><span class="FontName">import org.springframework.context.annotation.ComponentScan;</span><br class="calibre10"/><span class="FontName">import org.springframework.context.annotation.Configuration;</span><br class="calibre10"/><span class="FontName">import org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">@Configuration</span><br class="calibre10"/><span class="FontName">@EnableWebMvc</span><br class="calibre10"/><span class="FontName">@ComponentScan(basePackages = "com.apress.springrecipes.court.web")</span><br class="calibre10"/><span class="FontName">public class CourtRestConfiguration {</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">@Bean</span><br class="calibre10"/>    <span class="FontName">public MemberService memberService() {</span><br class="calibre10"/>        <span class="FontName">return new InMemoryMemberService();</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">When the application is deployed and you do request the members from <span class="FontName">http://localhost:8080/court/members.json</span> it will give the same results as before.</p>
<pre class="calibre11"><span class="FontName">{</span><br class="calibre10"/>  <span class="FontName">"members" : {</span><br class="calibre10"/>    <span class="FontName">"members" : [ {</span><br class="calibre10"/>      <span class="FontName">"name" : "Marten Deinum",</span><br class="calibre10"/>      <span class="FontName">"phone" : "00-31-1234567890",</span><br class="calibre10"/>      <span class="FontName">"email" : "marten@deinum.biz"</span><br class="calibre10"/>    <span class="FontName">}, {</span><br class="calibre10"/>      <span class="FontName">"name" : "John Doe",</span><br class="calibre10"/>      <span class="FontName">"phone" : "1-800-800-800",</span><br class="calibre10"/>      <span class="FontName">"email" : "</span><span class="FontName"><a href="mailto:john@doe.com" class="calibre5">john@doe.com</a></span><span class="FontName">"</span><br class="calibre10"/>    <span class="FontName">}, {</span><br class="calibre10"/>      <span class="FontName">"name" : "Jane Doe",</span><br class="calibre10"/>      <span class="FontName">"phone" : "1-801-802-803",</span><br class="calibre10"/>      <span class="FontName">"email" : "</span><span class="FontName"><a href="mailto:jane@doe.com" class="calibre5">jane@doe.com</a></span><span class="FontName">"</span><br class="calibre10"/>    <span class="FontName">} ]</span><br class="calibre10"/>  <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">You probably noticed that the <span class="FontName">RestMemberController</span> and <span class="FontName">CourtRestConfiguration</span> are now exactly the same as the in Recipe 5-1.  When calling <span class="FontName">http://localhost:8080/court/members.xml</span> you will get XML.</p>
<p class="indent">How is this possible without any additional configuration? Spring MVC will detect what is on the classpath it automatically detects JAXB2, Jackson (1 and 2), and Rome (see Recipe 5-4) it will register the appropriate <span class="FontName">HttpMessageConverter</span> for the available technologies.</p>
<p id="Sec15" class="Heading">5-3. Accessing a REST Service with Spring</p>
<p id="Sec16" class="Heading1">Problem</p>
<p class="noindent">You want to access a REST service from a third party (e.g., Google, Yahoo, another business partner) and use its payload inside a Spring application.</p>
<p id="Sec17" class="Heading1">Solution</p>
<p class="noindent">Accessing a third-party REST service inside a Spring application revolves around the use of the Spring <span class="FontName">RestTemplate</span> class.</p>
<p class="indent">The <span class="FontName">RestTemplate</span> class<a id="cXXX.476" class="calibre5"></a> is designed on the same principles as the many other Spring <span class="FontName">*Template</span> classes (e.g., <span class="FontName">JdbcTemplate</span>, <span class="FontName">JmsTemplate</span> ), providing a simplified approach with default behaviors for performing lengthy tasks.</p>
<p class="indent">This means the processes of invoking a REST service and using its returning payload are streamlined in Spring applications.</p>
<p id="Sec18" class="Heading1">How It Works</p>
<p class="noindent">Before describing the particularities of the <span class="FontName">RestTemplate</span> class, it’s worth exploring the life cycle of a REST service, so you’re aware of the actual work the <span class="FontName">RestTemplate</span> class performs. Exploring the life cycle of a REST service can best be done from a browser, so open your favorite browser on your workstation to get started.</p>
<p class="indent">The first thing that’s needed is a REST service endpoint. We are going to reuse the endpoint we created in Recipe 5-2. This endpoint should be available at <span class="FontName">http://localhost:8080/court/members.xml</span> (or <span class="FontName">.json</span>). If you load this last REST service end point on your browser, the browser performs<a id="cXXX.477" class="calibre5"></a> a <span class="FontName">GET</span> request, which is one of the most popular HTTP requests supported by REST services. Upon loading the REST service, the browser displays a responding payload like the following:</p>
<pre class="calibre11"><span class="FontName">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span><br class="calibre10"/><span class="FontName">&lt;members&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;member&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;email&gt;marten@deinum.biz&lt;/email&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;name&gt;Marten Deinum&lt;/name&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;phone&gt;00-31-1234567890&lt;/phone&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;/member&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;member&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;email&gt;</span><span class="FontName"><a href="mailto:john@doe.com" class="calibre5">john@doe.com</a></span><span class="FontName">&lt;/email&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;name&gt;John Doe&lt;/name&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;phone&gt;1-800-800-800&lt;/phone&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;/member&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;member&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;email&gt;</span><span class="FontName"><a href="mailto:jane@doe.com" class="calibre5">jane@doe.com</a></span><span class="FontName">&lt;/email&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;name&gt;Jane Doe&lt;/name&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;phone&gt;1-801-802-803&lt;/phone&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;/member&gt;</span><br class="calibre10"/><span class="FontName">&lt;/members&gt;</span></pre>
<p class="indent">This last payload represents a well-formed XML fragment, which is in line with most REST service’s responses. The actual meaning of the payload is highly dependent on a REST service. In this case, the XML tags <span class="FontName">(&lt;Members&gt;</span>, <span class="FontName">&lt;Member&gt;</span> etc.) are definitions set forth by ourselves, while the character data enclosed in each XML tag represents information related to a REST service’s request.</p>
<p class="indent">It’s the task of a REST service consumer (i.e., you) to know the payload structure—sometimes referred to as <i class="calibre8">vocabulary</i>—of a REST service to appropriately process its information. Though this last REST service relies on what can be considered a custom vocabulary, a series of REST services often rely on standardized vocabularies (e.g., RSS), which make the processing of REST service payloads uniform. In addition, it’s also worth noting that some REST services provide Web Application Description Language (WADL<a id="cXXX.478" class="calibre5"></a>) contracts to facilitate the discovery and consumption of payloads.<a id="cXXX.479" class="calibre5"></a></p>
<p class="indent">Now that you’re familiar with a REST service’s life cycle using your browser, we can take a look at how to use the Spring <span class="FontName">RestTemplate</span> class in order to incorporate a REST service’s payload into a Spring application.</p>
<p class="indent">Given that the <span class="FontName">RestTemplate</span> class is designed to call REST services, it should come as no surprise that its main methods are closely tied to REST’s underpinnings, which are the HTTP protocol’s methods: <span class="FontName">HEAD</span>, <span class="FontName">GET</span>, <span class="FontName">POST</span>, <span class="FontName">PUT</span>, <span class="FontName">DELETE</span>, and <span class="FontName">OPTIONS</span>. <a id="_Tab1" href="part0015.html#Tab1" class="calibre5">Table 5-1</a> contains the main methods supported by the <span class="FontName">RestTemplate</span> class.</p>
<div class="Table" id="Tab1">
<p class="TabCapt"><span class="calibre4"><a href="part0015.html#_Tab1" class="calibre5">Table 5-1</a>.</span> RestTemplate class methods based on HTTP protocol’s request methods<a id="cXXX.480" class="calibre5"></a></p>
<table border="0" class="calibre12"><thead class="calibre13"><tr class="header"><th valign="top" class="calibre14">
<p class="tab-left">Method</p></th><th valign="top" class="calibre14">
<p class="tab-left">Description</p></th></tr></thead><tbody class="calibre15"><tr class="noclass"><td valign="top" class="calibre16">
<p class="tab-leftt"><span class="FontName">headForHeaders(String, Object...)</span></p></td><td valign="top" class="calibre16">
<p class="tab-leftt">Performs an HTTP <span class="FontName">HEAD</span> operation</p></td></tr><tr class="noclass"><td valign="top" class="calibre16">
<p class="tab-leftt"><span class="FontName">getForObject(String, Class, Object...)</span></p></td><td valign="top" class="calibre16">
<p class="tab-leftt">Performs an HTTP <span class="FontName">GET</span> operation and return the result as a type of the given class.</p></td></tr><tr class="noclass"><td valign="top" class="calibre16">
<p class="tab-leftt"><span class="FontName">getForObject(String, Class, Object...)</span></p></td><td valign="top" class="calibre16">
<p class="tab-leftt">Performs an HTTP <span class="FontName">GET</span> operation and return a <span class="FontName">ResponseEntity</span>.</p></td></tr><tr class="noclass"><td valign="top" class="calibre16">
<p class="tab-leftt"><span class="FontName">postForLocation(String, Object, Object...)</span></p></td><td valign="top" class="calibre16">
<p class="tab-leftt">Performs an HTTP <span class="FontName">POST</span> operation and return the value of the location header.</p></td></tr><tr class="noclass"><td valign="top" class="calibre16">
<p class="tab-leftt"><span class="FontName">postForObject(String, Object, Class, Object...)</span></p></td><td valign="top" class="calibre16">
<p class="tab-leftt">Performs an HTTP <span class="FontName">POST</span> operation and return the result as a type of the given class.</p></td></tr><tr class="noclass"><td valign="top" class="calibre16">
<p class="tab-leftt"><span class="FontName">postForEntity(String, Object, Class, Object...)</span></p></td><td valign="top" class="calibre16">
<p class="tab-leftt">Performs an HTTP <span class="FontName">POST</span> operation and return a <span class="FontName">ResponseEntity</span>.</p></td></tr><tr class="noclass"><td valign="top" class="calibre16">
<p class="tab-leftt"><span class="FontName">put(String, Object, Object...)</span></p></td><td valign="top" class="calibre16">
<p class="tab-leftt">Performs an HTTP <span class="FontName">PUT</span> operation</p></td></tr><tr class="noclass"><td valign="top" class="calibre16">
<p class="tab-leftt"><span class="FontName">delete(String, Object...)</span></p></td><td valign="top" class="calibre16">
<p class="tab-leftt">Performs an HTTP <span class="FontName">DELETE</span> operation</p></td></tr><tr class="noclass"><td valign="top" class="calibre16">
<p class="tab-leftt"><span class="FontName">optionsForAllow(String, Object...)</span></p></td><td valign="top" class="calibre16">
<p class="tab-leftt">Performs an HTTP <span class="FontName">OPTIONS</span> operation</p></td></tr><tr class="noclass"><td valign="top" class="calibre16">
<p class="tab-leftt"><span class="FontName">execute(String, HttpMethod, RequestCallback, ResponseExtractor, Object...)</span></p></td><td valign="top" class="calibre16">
<p class="tab-leftt">Can perform any HTTP operation with the exception of <span class="FontName">CONNECT</span></p></td></tr></tbody></table>
</div>
<p class="indent">As you can observe in <a href="part0015.html#Tab1" class="calibre5">Table 5-1</a>, the <span class="FontName">RestTemplate</span> class methods are prefixed with a series of HTTP protocol methods that include <span class="FontName">HEAD</span>, <span class="FontName">GET</span>, <span class="FontName">POST</span>, <span class="FontName">PUT</span>, <span class="FontName">DELETE</span>, and <span class="FontName">OPTIONS</span>. In addition, the <span class="FontName">execute</span> method serves as a general-purpose method that can perform any HTTP operation, including the more esoteric HTTP protocol <span class="FontName">TRACE</span> method, albeit not the <span class="FontName">CONNECT</span> method, the last of which is not supported by the underlying <span class="FontName">HttpMethod enum</span> used by the <span class="FontName">execute</span> method.</p>
<div class="notepara">
<p class="paraaftertitle"><img src="../images/00016.jpeg" alt="Image" class="calibre3"/> <b class="calibre4">Note</b>  By far the most common HTTP method used in REST services is <span class="FontName">GET</span>, since it represents a safe operation to obtain information (i.e., it doesn’t modify any data). On the other hand, HTTP methods such as <span class="FontName">PUT</span>, <span class="FontName">POST</span>, and <span class="FontName">DELETE</span> are designed to modify a provider’s information, which makes them less likely to be supported by a REST service provider. For cases in which data modification needs to take place, many providers opt for the SOAP protocol, which is an alternative mechanism to using REST services.</p></div>
<p class="indent">Now that you’re aware of the <span class="FontName">RestTemplate</span> class methods, we can move on to invoking the same REST service you did with your browser previously, except this time using Java code from the Spring framework. The following listing illustrates a class that accesses the REST service and returns its contents to the <span class="FontName">System.out</span>.</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.court;</span><br class="calibre10"/><br class="calibre10"/><b class="calibre4">import org.springframework.web.client.RestTemplate;</b><br class="calibre10"/><br class="calibre10"/><span class="FontName">public class Main {</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">public static void main(String[] args) throws Exception {</span><br class="calibre10"/>        <span class="FontName">final String uri = "</span><span class="FontName">http://localhost:8080/court/members.json</span><span class="FontName">";</span><br class="calibre10"/>        <span class="FontName">RestTemplate restTemplate = new RestTemplate();</span><br class="calibre10"/>        <span class="FontName">String result = restTemplate.getForObject(uri, String.class);</span><br class="calibre10"/>        <span class="FontName">System.out.println(result);</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<div class="notepara">
<p class="paraaftertitle"><img src="../images/00016.jpeg" alt="Image" class="calibre3"/> <b class="calibre4">Caution</b>  Some REST service providers restrict access to their data feeds depending on the requesting party. Access is generally denied by relying on data present in a request (e.g., HTTP headers or IP address). So depending on the circumstances, a provider can return an access denied response even when a data feed appears to be working in another medium (e.g., you might be able to access a REST service in a browser but get an accessed denied response when attempting to access the same feed from a Spring application). This depends on the terms of use set forth by a REST provider.</p></div>
<p class="indent">The first line marked in bold declares the import statement needed to access the <span class="FontName">RestTemplate</span> class within a class’s body. First we need to create an instance of the <span class="FontName">RestTemplate</span>.</p>
<p class="indent">Next, you can find a call made to the <span class="FontName">getForObject</span> method<a id="cXXX.481" class="calibre5"></a> that belongs to the <span class="FontName">RestTemplate</span> class, which as described in <a href="part0015.html#Tab1" class="calibre5">Table 5-1</a> is used to perform an HTTP <span class="FontName">GET</span> operation—just like the one performed by a browser to obtain a REST service’s payload. There are two important aspects related to this last method, its response and its parameters.</p>
<p class="indent">The response of calling the <span class="FontName">getForObject</span> method is assigned to a <span class="FontName">String</span> object. This means the same output you saw on your browser for this REST service (i.e., the XML structure) is assigned to a <span class="FontName">String</span>. Even if you’ve never processed XML in Java, you’re likely aware that extracting and manipulating data as a Java <span class="FontName">String</span> is not an easy task. In other words, there are classes better suited for processing XML data, and with it a REST service’s payload, than a <span class="FontName">String</span> object. For the moment just keep this in mind; other recipes in the chapter illustrate how to better extract and manipulate the data obtained from a REST service.</p>
<p class="indent">The parameters passed to the <span class="FontName">getForObject</span> method consist of the actual REST service end point. The first parameter corresponds to the URL (i.e., endpoint) declaration. Notice the URL is identical to the one used when you relied on a browser to call it.</p>
<p class="indent">When executed the output will be the same as in the browser except that it is now printed in the console.</p>
<p id="Sec19" class="Heading2">Retrieving data from a parameterized URL<a id="cXXX.482" class="calibre6"></a></p>
<p class="noindent">The previous section showed how we can call a URI to retrieve data, but what about a URI that requires parameters. We don’t want to hardcode parameters into the URL. With the RestTemplate we can use a URL with placeholders, these placeholders will be replaced with actual values upon execution. Placeholders are defined using { and }, just as with a request mapping (See Recipes 5-1 and 5-2).</p>
<p class="indent">The URI <span class="FontName">http://localhost:8080/court/member/{memberId</span><span class="FontName">}</span> is an example of such a parameterized URI. To be able to call this method we need to pass in a value for the placeholder, we can do this by using a <span class="FontName">Map</span> and pass that as the third parameter to the <span class="FontName">getForObject</span> method of the <span class="FontName">RestTemplate</span>.</p>
<pre class="calibre11"><span class="FontName">public class Main {</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">public static void main(String[] args) throws Exception {</span><br class="calibre10"/>        <span class="FontName">final String uri = "</span><span class="FontName">http://localhost:8080/court/member/{memberId</span><span class="FontName">}";</span><br class="calibre10"/>        <span class="FontName">Map&lt;String, String&gt; params = new HashMap&lt;&gt;();</span><br class="calibre10"/>        <span class="FontName">params.put("memberId", "1");</span><br class="calibre10"/>        <span class="FontName">RestTemplate restTemplate = new RestTemplate();</span><br class="calibre10"/>        <span class="FontName">String result = restTemplate.getForObject(uri, String.class, params );</span><br class="calibre10"/>        <span class="FontName">System.out.println(result);</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">This last snippet makes use of the <span class="FontName">HashMap</span> class—part of the Java collections framework—creating an instance with the corresponding REST service parameters, which is later passed to the <span class="FontName">getForObject</span> method of the <span class="FontName">RestTemplate</span> class. The results obtained by passing either a series of <span class="FontName">String</span> parameters or a single <span class="FontName">Map</span> parameter to the various <span class="FontName">RestTemplate</span> methods is identical.</p>
<p id="Sec20" class="Heading2">Retrieving data as mapped object<a id="cXXX.483" class="calibre6"></a></p>
<p class="noindent">Instead of returning a <span class="FontName">String</span> to be used in our application we can also (re)use our <span class="FontName">Members</span> and <span class="FontName">Member</span> classes to map the result. Instead of passing in <span class="FontName">String.class</span> as the second parameter pass <span class="FontName">Members.class</span> and the response will be mapped onto this class.</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.court;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import com.apress.springrecipes.court.domain.Members;</span><br class="calibre10"/><span class="FontName">import org.springframework.web.client.RestTemplate;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">public class Main {</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">public static void main(String[] args) throws Exception {</span><br class="calibre10"/>        <span class="FontName">final String uri = "</span><span class="FontName">http://localhost:8080/court/members.xml</span><span class="FontName">";</span><br class="calibre10"/>        <span class="FontName">RestTemplate restTemplate = new RestTemplate();</span><br class="calibre10"/>        <b class="calibre4">Members</b> <span class="FontName">result = restTemplate.getForObject(uri,</span> <b class="calibre4">Members.class</b><span class="FontName">);</span><br class="calibre10"/>        <span class="FontName">System.out.println(result);</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">The <span class="FontName">RestTemplate</span> makes use of the same <span class="FontName">HttpMessageConverter</span> infrastructure as a controller with <span class="FontName">@ResponseBody</span> marked methods. As Jaxb2 (as well as Jackson) is automatically detected mapping to a Jaxb mapped object is quite easy.</p>
<p id="Sec21" class="Heading">5-4. Publishing RSS and Atom feeds</p>
<p id="Sec22" class="Heading1">Problem</p>
<p class="noindent">You want to publish an RSS or Atom feed<a id="cXXX.484" class="calibre5"></a> in a Spring application.</p>
<p id="Sec23" class="Heading1">Solution</p>
<p class="noindent">RSS and Atom feeds have become a popular means by which to publish information. Access to these types of feeds is provided by means of a REST service, which means building a REST service is a prerequisite to publishing RSS and Atom feeds.</p>
<p class="indent">In addition to relying on Spring’s REST support, it’s also convenient to rely on a third-party library especially designed to deal with the particularities of RSS and Atom feeds. This makes it easier for a REST service to publish this type of XML payload. For this last purpose, we will use Project Rome, an open source library available at <span class="FontName"><a href="http://rometools.github.io/rome/" class="calibre5">http://rometools.github.io/rome/</a></span>.</p>
<div class="notepara">
<p class="paraaftertitle"><img src="../images/00016.jpeg" alt="Image" class="calibre3"/> <b class="calibre4">Note</b>  Project Rome<a id="cXXX.485" class="calibre5"></a> depends on the JDOM library that can be downloaded at <span class="FontName"><a href="http://www.jdom.org/" class="calibre5">http://www.jdom.org/</a></span>. If you are using Maven, you can add the following dependency to your pom.xml file:</p>
<pre class="calibre19"><span class="FontName1">&lt;dependency&gt;</span><br class="calibre2"/>  <span class="FontName1">&lt;groupId&gt;org.jdom&lt;/groupId&gt;</span><br class="calibre2"/>  <span class="FontName1">&lt;artifactId&gt;jdom&lt;/artifactId&gt;</span><br class="calibre2"/>  <span class="FontName1">&lt;version&gt;1.1&lt;/version&gt;</span><br class="calibre2"/><span class="FontName1">&lt;/dependency&gt;</span></pre></div>
<div class="notepara">
<p class="paraaftertitle"><img src="../images/00016.jpeg" alt="Image" class="calibre3"/> <b class="calibre4">Tip</b>  Even though RSS and Atom feeds are often categorized as news feeds, they have surpassed this initial usage scenario of providing just news. Nowadays, RSS and Atom feeds are used to publish information related to blogs, weather, travel, and many other things in a cross-platform manner (i.e., using XML). Hence, if you require publishing information of any sort that’s to be accessible in a cross-platform manner, doing so as RSS or Atom feeds can be an excellent choice given their wide adoption (e.g., many applications support them and many developers know their structure).</p></div>
<p id="Sec24" class="Heading1">How It Works</p>
<p class="noindent">The first thing you need to do is determine the information you wish to publish as an RSS or Atom news feed. This information can be located in an RDBMS or text file, accessed through JDBC or ORM, inclusively be part of a Spring bean or some other type of construct. Describing how to obtain this information would go beyond the scope of this recipe, so we will assume you’ll use whatever means you deem appropriate to access it.</p>
<p class="indent">Once you’ve pinpointed the information you wish to publish, it’s necessary to structure it as either an RSS or Atom feed, which is where Project Rome comes into the picture.</p>
<p class="indent">In case you’re unfamiliar with an Atom feed’s structure<a id="cXXX.486" class="calibre5"></a>, the following snippet illustrates a fragment of this format:</p>
<pre class="calibre11"><span class="FontName">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br class="calibre10"/><span class="FontName">&lt;feed  xmlns="</span><span class="FontName"><a href="http://www.w3.org/2005/Atom" class="calibre5">http://www.w3.org/2005/Atom</a></span><span class="FontName">"&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;title&gt;Example Feed&lt;/title&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;link href="</span><span class="FontName"><a href="http://example.org/" class="calibre5">http://example.org/</a></span><span class="FontName">"/&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;updated&gt;2010-08-31T18:30:02Z&lt;/updated&gt;</span><br class="calibre10"/>        <span class="FontName">272103_1_En</span><br class="calibre10"/>                <span class="FontName">&lt;name&gt;John Doe&lt;/name&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;/author&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;id&gt;urn:uuid:60a76c80-d399-11d9-b93C-0003939e0af6&lt;/id&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;entry&gt;</span><br class="calibre10"/>                <span class="FontName">&lt;title&gt;Atom-Powered Robots Run Amok&lt;/title&gt;</span><br class="calibre10"/>                <span class="FontName">&lt;link href="</span><span class="FontName"><a href="http://example.org/2010/08/31/atom03" class="calibre5">http://example.org/2010/08/31/atom03</a></span><span class="FontName">"/&gt;</span><br class="calibre10"/>                <span class="FontName">&lt;id&gt;urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a&lt;/id&gt;</span><br class="calibre10"/>                <span class="FontName">&lt;updated&gt;2010-08-31T18:30:02Z&lt;/updated&gt;</span><br class="calibre10"/>                <span class="FontName">&lt;summary&gt;Some text.&lt;/summary&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;/entry&gt;</span><br class="calibre10"/><span class="FontName">&lt;/feed&gt;</span></pre>
<p class="indent">The following snippet illustrates a fragment of an RSS feed’s structure:</p>
<pre class="calibre11"><span class="FontName">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br class="calibre10"/><span class="FontName">&lt;rss version="2.0"&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;channel&gt;</span><br class="calibre10"/>                <span class="FontName">&lt;title&gt;RSS Example&lt;/title&gt;</span><br class="calibre10"/>                <span class="FontName">&lt;description&gt;This is an example of an RSS feed&lt;/description&gt;</span><br class="calibre10"/>                <span class="FontName">&lt;link&gt;</span><span class="FontName"><a href="http://www.example.org/link.htm&lt;/link" class="calibre5">http://www.example.org/link.htm&lt;/link</a></span><span class="FontName">&gt;</span><br class="calibre10"/>                <span class="FontName">&lt;lastBuildDate&gt;Mon, 28 Aug 2006 11:12:55 -0400 &lt;/lastBuildDate&gt;</span><br class="calibre10"/>                <span class="FontName">&lt;pubDate&gt;Tue, 31 Aug 2010 09:00:00 -0400&lt;/pubDate&gt;</span><br class="calibre10"/>                <span class="FontName">&lt;item&gt;</span><br class="calibre10"/>                        <span class="FontName">&lt;title&gt;Item Example&lt;/title&gt;</span><br class="calibre10"/>                        <span class="FontName">&lt;description&gt;This is an example of an Item&lt;/description&gt;</span><br class="calibre10"/>                        <span class="FontName">&lt;link&gt;</span><span class="FontName"><a href="http://www.example.org/link.htm&lt;/link" class="calibre5">http://www.example.org/link.htm&lt;/link</a></span><span class="FontName">&gt;</span><br class="calibre10"/>                        <span class="FontName">&lt;guid isPermaLink="false"&gt; 1102345&lt;/guid&gt;</span><br class="calibre10"/>                        <span class="FontName">&lt;pubDate&gt;Tue, 31 Aug 2010 09:00:00 -0400&lt;/pubDate&gt;</span><br class="calibre10"/>                <span class="FontName">&lt;/item&gt;</span><br class="calibre10"/>        <span class="FontName">&lt;/channel&gt;</span><br class="calibre10"/><span class="FontName">&lt;/rss&gt;</span></pre>
<p class="indent">As you can observe from these last two snippets, RSS and Atom feeds are just XML payloads that rely on a series of elements to publish information. Though going into the finer details of either an RSS or Atom feed structure would require a book in itself, both formats possess a series of common characteristics; chief among them are these:</p>
<ul class="bulleted">
<li class="calibre17">They have a metadata section to describe the contents of a feed. (e.g., the <span class="FontName">272103_1_En</span> and <span class="FontName">&lt;title&gt;</span> elements for the Atom format and the <span class="FontName">&lt;description&gt;</span> and <span class="FontName">&lt;pubDate&gt;</span> elements for the RSS format).</li>
<li class="calibre17">They have recurring elements to describe information (e.g., the <span class="FontName">&lt;entry&gt;</span> element for the Atom feed format and the <span class="FontName">&lt;item&gt;</span> element for the RSS feed format). In addition, each recurring element also has its own set of elements with which to further describe information.</li>
<li class="calibre17">They have multiple versions. RSS versions include 0.90, 0.91 Netscape, 0.91 Userland, 0.92, 0.93, 0.94, 1.0, and 2.0. Atom versions include 0.3 and 1.0.</li></ul>
<p class="indent">Project Rome allows you to create a feed’s metadata section, recurring elements, as well as any of the previously mentioned versions, from information available in Java code (e.g., <span class="FontName">String</span>s, <span class="FontName">Map</span>s, or other such constructs).</p>
<p class="indent">Now that you’re aware of the structure of an RSS and Atom feed, as well as the role Project Rome plays in this recipe, let’s take a look at a Spring MVC controller charged with presenting a feed to an end user.</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.court.web;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import org.springframework.stereotype.Controller;</span><br class="calibre10"/><span class="FontName">import org.springframework.ui.Model;</span><br class="calibre10"/><span class="FontName">import org.springframework.web.bind.annotation.RequestMapping;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import com.apress.springrecipes.court.feeds.TournamentContent;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import com.apress.springrecipes.court.domain.Member;</span><br class="calibre10"/><span class="FontName">import java.util.List;</span><br class="calibre10"/><span class="FontName">import java.util.Date;</span><br class="calibre10"/><span class="FontName">import java.util.ArrayList;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">@Controller</span><br class="calibre10"/><span class="FontName">public class FeedController {</span><br class="calibre10"/><br class="calibre10"/>    <b class="calibre4">@RequestMapping("/atomfeed")</b><br class="calibre10"/>    <span class="FontName">public String getAtomFeed(Model model) {</span><br class="calibre10"/>        <b class="calibre4">List&lt;TournamentContent&gt; tournamentList = new ArrayList&lt;TournamentContent&gt;();</b><br class="calibre10"/>        <span class="FontName">tournamentList.add(TournamentContent.generateContent("ATP", <img src="../images/00053.jpeg" alt="image" class="calibre3"/></span><br class="calibre10"/>                                  <span class="FontName">new Date(),"Australian Open","</span><span class="FontName"><a href="http://www.australianopen.com" class="calibre5">www.australianopen.com</a></span><span class="FontName">"));</span><br class="calibre10"/>        <span class="FontName">tournamentList.add(TournamentContent.generateContent("ATP", <img src="../images/00053.jpeg" alt="image" class="calibre3"/></span><br class="calibre10"/>                                  <span class="FontName">new Date(),"Roland Garros","</span><span class="FontName"><a href="http://www.rolandgarros.com" class="calibre5">www.rolandgarros.com</a></span><span class="FontName">"));</span><br class="calibre10"/>        <span class="FontName">tournamentList.add(TournamentContent.generateContent("ATP", <img src="../images/00053.jpeg" alt="image" class="calibre3"/></span><br class="calibre10"/>                                  <span class="FontName">new Date(),"Wimbledon","</span><span class="FontName"><a href="http://www.wimbledon.org" class="calibre5">www.wimbledon.org</a></span><span class="FontName">"));</span><br class="calibre10"/>        <span class="FontName">tournamentList.add(TournamentContent.generateContent("ATP", <img src="../images/00053.jpeg" alt="image" class="calibre3"/></span><br class="calibre10"/>                                  <span class="FontName">new Date(),"US Open","</span><span class="FontName"><a href="http://www.usopen.org" class="calibre5">www.usopen.org</a></span><span class="FontName">"));</span><br class="calibre10"/>        <b class="calibre4">model.addAttribute("feedContent",tournamentList);</b><br class="calibre10"/>        <b class="calibre4">return "atomfeedtemplate";</b><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/><br class="calibre10"/>    <b class="calibre4">@RequestMapping("/rssfeed")</b><br class="calibre10"/>    <span class="FontName">public String getRSSFeed(Model model) {</span><br class="calibre10"/>        <b class="calibre4">List&lt;TournamentContent&gt; tournamentList = new ArrayList&lt;TournamentContent&gt;();</b><br class="calibre10"/>        <span class="FontName">tournamentList.add(TournamentContent.generateContent("FIFA", <img src="../images/00053.jpeg" alt="image" class="calibre3"/></span><br class="calibre10"/>                 <span class="FontName">new Date(),"World Cup","</span><span class="FontName"><a href="http://www.fifa.com/worldcup/" class="calibre5">www.fifa.com/worldcup/</a></span><span class="FontName">"));</span><br class="calibre10"/>        <span class="FontName">tournamentList.add(TournamentContent.generateContent("FIFA", <img src="../images/00053.jpeg" alt="image" class="calibre3"/></span><br class="calibre10"/>                 <span class="FontName">new Date(),"U-20 World Cup","</span><span class="FontName"><a href="http://www.fifa.com/u20worldcup/" class="calibre5">www.fifa.com/u20worldcup/</a></span><span class="FontName">"));</span><br class="calibre10"/>        <span class="FontName">tournamentList.add(TournamentContent.generateContent("FIFA", <img src="../images/00053.jpeg" alt="image" class="calibre3"/></span><br class="calibre10"/>                 <span class="FontName">new Date(),"U-17 World Cup","</span><span class="FontName"><a href="http://www.fifa.com/u17worldcup/" class="calibre5">www.fifa.com/u17worldcup/</a></span><span class="FontName">"));</span><br class="calibre10"/>        <span class="FontName">tournamentList.add(TournamentContent.generateContent("FIFA", <img src="../images/00053.jpeg" alt="image" class="calibre3"/></span><br class="calibre10"/>                 <span class="FontName">new Date(),"Confederations Cup","</span><span class="FontName"><a href="http://www.fifa.com/confederationscup/" class="calibre5">www.fifa.com/confederationscup/</a></span><span class="FontName">"));</span><br class="calibre10"/>        <b class="calibre4">model.addAttribute("feedContent",tournamentList);</b><br class="calibre10"/>        <b class="calibre4">return "rssfeedtemplate";</b><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">This last Spring MVC controller has two handler methods. One called <span class="FontName">getAtomFeed()</span><a id="cXXX.487" class="calibre5"></a>, which is mapped to a URL in the form <span class="FontName">http://[host_name]/[app-name]/atomfeed</span>, and another called <span class="FontName">getRSSFeed()</span>, which is mapped to a URL in the form <span class="FontName">http://[host_name]/[app-name]/rssfeed</span>.</p>
<p class="indent">Each handler method<a id="cXXX.488" class="calibre5"></a> defines a <span class="FontName">List</span> of <span class="FontName">TournamentContent</span> objects, where the backing class for a <span class="FontName">TournamentContent</span> object is a POJO. This <span class="FontName">List</span> is then assigned to the handler method’s <span class="FontName">Model</span> object in order for it to become accessible to the returning view. The returning logical views for each handler methods are <span class="FontName">atomfeedtemplate</span> and <span class="FontName">rssfeedtemplate</span>, respectively. These logical views are defined in the following manner inside a Spring configuration class:</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.court.web.config;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import com.apress.springrecipes.court.feeds.AtomFeedView;</span><br class="calibre10"/><span class="FontName">import com.apress.springrecipes.court.feeds.RSSFeedView;</span><br class="calibre10"/><span class="FontName">import com.apress.springrecipes.court.service.InMemoryMemberService;</span><br class="calibre10"/><span class="FontName">import com.apress.springrecipes.court.service.MemberService;</span><br class="calibre10"/><span class="FontName">import org.springframework.context.annotation.Bean;</span><br class="calibre10"/><span class="FontName">import org.springframework.context.annotation.ComponentScan;</span><br class="calibre10"/><span class="FontName">import org.springframework.context.annotation.Configuration;</span><br class="calibre10"/><span class="FontName">import org.springframework.web.servlet.HandlerMapping;</span><br class="calibre10"/><span class="FontName">import org.springframework.web.servlet.config.annotation.EnableWebMvc;</span><br class="calibre10"/><span class="FontName">import org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">@Configuration</span><br class="calibre10"/><span class="FontName">@EnableWebMvc</span><br class="calibre10"/><span class="FontName">@ComponentScan(basePackages = "com.apress.springrecipes.court.web")</span><br class="calibre10"/><span class="FontName">public class CourtRestConfiguration {</span><br class="calibre10"/><br class="calibre10"/>    <b class="calibre4">@Bean</b><br class="calibre10"/>    <b class="calibre4">public AtomFeedView atomfeedtemplate() {</b><br class="calibre10"/>        <b class="calibre4">return new AtomFeedView();</b><br class="calibre10"/>    <b class="calibre4">}</b><br class="calibre10"/><br class="calibre10"/>    <b class="calibre4">@Bean</b><br class="calibre10"/>    <b class="calibre4">public RSSFeedView rssfeedtemplate() {</b><br class="calibre10"/>        <b class="calibre4">return new RSSFeedView();</b><br class="calibre10"/>    <b class="calibre4">}</b><br class="calibre10"/><span class="FontName">...</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">As you can observe, each logical view is mapped to a class. Each of these classes is charged with implementing the necessary logic to build either an Atom or RSS view. If you recall from <a href="part0014.html" class="calibre5">Chapter 4</a>, you used an identical approach (i.e., using classes) for implementing PDF and Excel views.</p>
<p class="indent">In the case of Atom and RSS views, Spring comes equipped with two classes specially equipped and built on the foundations of Project Rome. These classes are <span class="FontName">AbstractAtomFeedView</span> and <span class="FontName">AbstractRssFeedView</span>. Such classes provide the foundations to build an Atom or RSS feed, without dealing in the finer details of each of these formats.</p>
<p class="indent">The following listing illustrates the <span class="FontName">AtomFeedView<a id="cXXX.2008" class="calibre5"></a></span> class<a id="cXXX.489" class="calibre5"></a> which implements the <span class="FontName">AbstractAtomFeedView</span> class and is used to back the <span class="FontName">atomfeedtemplate</span> logical view:</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.court.feeds;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import javax.servlet.http.HttpServletRequest;</span><br class="calibre10"/><span class="FontName">import javax.servlet.http.HttpServletResponse;</span><br class="calibre10"/><br class="calibre10"/><b class="calibre4">import com.sun.syndication.feed.atom.Feed;</b><br class="calibre10"/><b class="calibre4">import com.sun.syndication.feed.atom.Entry;</b><br class="calibre10"/><b class="calibre4">import com.sun.syndication.feed.atom.Content;</b><br class="calibre10"/><br class="calibre10"/><b class="calibre4">import org.springframework.web.servlet.view.feed.AbstractAtomFeedView;</b><br class="calibre10"/><br class="calibre10"/><span class="FontName">import java.util.Date;</span><br class="calibre10"/><span class="FontName">import java.util.List;</span><br class="calibre10"/><span class="FontName">import java.util.ArrayList;</span><br class="calibre10"/><span class="FontName">import java.util.Map;</span><br class="calibre10"/><br class="calibre10"/><b class="calibre4">public class AtomFeedView extends AbstractAtomFeedView {</b><br class="calibre10"/>    <b class="calibre4">protected void buildFeedMetadata(Map model, Feed feed, HttpServletRequest request) {</b><br class="calibre10"/>        <span class="FontName">feed.setId("tag:tennis.org");</span><br class="calibre10"/>        <span class="FontName">feed.setTitle("Grand Slam Tournaments");</span><br class="calibre10"/>        <span class="FontName">List&lt;TournamentContent&gt; tournamentList = (List&lt;TournamentContent&gt;)model.get("feedContent");</span><br class="calibre10"/>        <span class="FontName">for (TournamentContent tournament : tournamentList) {</span><br class="calibre10"/>            <span class="FontName">Date date = tournament.getPublicationDate();</span><br class="calibre10"/>            <span class="FontName">if (feed.getUpdated() == null || date.compareTo(feed.getUpdated()) &gt; 0) {</span><br class="calibre10"/>                <span class="FontName">feed.setUpdated(date);</span><br class="calibre10"/>            <span class="FontName">}</span><br class="calibre10"/>        <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/>    <b class="calibre4">protected List buildFeedEntries(Map model,<img src="../images/00053.jpeg" alt="image" class="calibre3"/></b><br class="calibre10"/>    <b class="calibre4">HttpServletRequest request, HttpServletResponse response) throws Exception {</b><br class="calibre10"/>        <span class="FontName">List&lt;TournamentContent&gt; tournamentList = <img src="../images/00053.jpeg" alt="image" class="calibre3"/></span><br class="calibre10"/>                    <span class="FontName">(List&lt;TournamentContent&gt;)model.get("feedContent");</span><br class="calibre10"/>        <span class="FontName">List&lt;Entry&gt; entries = new ArrayList&lt;Entry&gt;(tournamentList.size());</span><br class="calibre10"/>        <span class="FontName">for (TournamentContent tournament : tournamentList) {</span><br class="calibre10"/>            <span class="FontName">Entry entry = new Entry();</span><br class="calibre10"/>            <span class="FontName">String date = String.format("%1$tY-%1$tm-%1$td",<img src="../images/00053.jpeg" alt="image" class="calibre3"/></span><br class="calibre10"/>                                       <span class="FontName">tournament.getPublicationDate());</span><br class="calibre10"/>            <span class="FontName">entry.setId(String.format("tag:tennis.org,%s:%d", date,<img src="../images/00053.jpeg" alt="image" class="calibre3"/></span><br class="calibre10"/>                                  <span class="FontName">tournament.getId()));</span><br class="calibre10"/>            <span class="FontName">entry.setTitle(String.format("%s - Posted by %s", <img src="../images/00053.jpeg" alt="image" class="calibre3"/></span><br class="calibre10"/>                                  <span class="FontName">tournament.getName(), tournament.getAuthor()));</span><br class="calibre10"/>            <span class="FontName">entry.setUpdated(tournament.getPublicationDate());</span><br class="calibre10"/>            <span class="FontName">Content summary = new Content();</span><br class="calibre10"/>            <span class="FontName">summary.setValue(String.format("%s - %s",<img src="../images/00053.jpeg" alt="image" class="calibre3"/></span><br class="calibre10"/>                                   <span class="FontName">tournament.getName(),tournament.getLink()));</span><br class="calibre10"/>            <span class="FontName">entry.setSummary(summary);</span><br class="calibre10"/>            <span class="FontName">entries.add(entry);</span><br class="calibre10"/>            <span class="FontName">}</span><br class="calibre10"/>        <b class="calibre4">return entries;</b><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><span class="FontName">}</span></pre>
<p class="indent">The first thing to notice about this class is that it imports several Project Rome classes from the <span class="FontName">com.sun.syndication.feed.atom</span> package, in addition to implementing the <span class="FontName">AbstractAtomFeedView</span> class provided by the Spring framework. In doing so, the only thing that’s needed next is to provide a feed’s implementation details for two methods inherited from the  <span class="FontName">AbstractAtomFeedView</span> class: <span class="FontName">buildFeedMetadata</span> and <span class="FontName">buildFeedEntries</span>.</p>
<p class="indent">The <span class="FontName">buildFeedMetadata</span> has three input parameters. A <span class="FontName">Map</span> object which represents the data used to build the feed (i.e., data assigned inside the handler method, in this case a <span class="FontName">List</span> of <span class="FontName">TournamentContent</span> objects), a <span class="FontName">Feed</span> object based on a Project Rome class that is used to manipulate the feed itself, and an <span class="FontName">HttpServletRequest</span> object in case it’s necessary to manipulate the HTTP request.</p>
<p class="indent">Inside the <span class="FontName">buildFeedMetadata</span> method<a id="cXXX.490" class="calibre5"></a>, you can observe several calls are made to the <span class="FontName">Feed</span> object’s setter methods (e.g., <span class="FontName">setId</span>, <span class="FontName">setTitle</span>, <span class="FontName">setUpdated</span>). Two of these calls are made using hard-coded strings, while another is made with a value determined after looping over a feed’s data (i.e., the <span class="FontName">Map</span> object). All these calls represent the assignment of an Atom feed’s metadata information.</p>
<div class="notepara">
<p class="paraaftertitle"><img src="../images/00016.jpeg" alt="Image" class="calibre3"/> <b class="calibre4">Note</b>  Consult Project Rome’s API if you want to assign more values to an Atom feed’s metadata section, as well as specify a particular Atom version. The default version is Atom 1.0.</p></div>
<p class="indent">The <span class="FontName">buildFeedEntries</span> method<a id="cXXX.491" class="calibre5"></a> also has three input parameters: a <span class="FontName">Map</span> object that represents the data used to build the feed (i.e., data assigned inside the handler method, in this case a <span class="FontName">List</span> of <span class="FontName">TournamentContent</span> objects), an <span class="FontName">HttpServletRequest</span> object in case it’s necessary to manipulate the HTTP request, and an <span class="FontName">HttpServletResponse</span> object in case it’s necessary to manipulate the HTTP response. It's also important to note the <span class="FontName">buildFeedEntries</span> method returns a <span class="FontName">List</span> objects, which in this case corresponds to a <span class="FontName">List</span> of <span class="FontName">Entry</span> objects based on a Project Rome class and containing an Atom feed’s recurring elements.</p>
<p class="indent">Inside the <span class="FontName">buildFeedEntries</span> method, you can observe that the <span class="FontName">Map</span> object is accessed to obtain the <span class="FontName">feedContent</span> object assigned inside the handler method. Once this is done, an empty <span class="FontName">List</span> of <span class="FontName">Entry</span> objects is created. Next, a loop is performed on the <span class="FontName">feedContent</span> object, which contains a list of a <span class="FontName">List</span> of <span class="FontName">TournamentContent</span> objects, and for each element, an <span class="FontName">Entry</span> object is created that is assigned to the top-level <span class="FontName">List</span> of <span class="FontName">Entry</span> objects. Once the loop is finished, the method returns a filled <span class="FontName">List</span> of <span class="FontName">Entry</span> objects.</p>
<div class="notepara">
<p class="paraaftertitle"><img src="../images/00016.jpeg" alt="Image" class="calibre3"/> <b class="calibre4">Note</b>  Consult Project Rome’s API if you want to assign more values to an Atom feed’s recurring elements section.</p></div>
<p class="indent">Upon deploying this last class, in addition to the previously cited Spring MVC controller<a id="cXXX.492" class="calibre5"></a>, accessing a URL in the form <span class="FontName">http://[host_name]/[app-name]/atomfeed.atom</span> (or <span class="FontName">http://[host_name]/atomfeed.xml</span>) would result in the following response:</p>
<pre class="calibre11"><span class="FontName">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br class="calibre10"/><span class="FontName">&lt;feed  xmlns="</span><span class="FontName"><a href="http://www.w3.org/2005/Atom" class="calibre5">http://www.w3.org/2005/Atom</a></span><span class="FontName">"&gt;</span><br class="calibre10"/>  <span class="FontName">&lt;title&gt;Grand Slam Tournaments&lt;/title&gt;</span><br class="calibre10"/>  <span class="FontName">&lt;id&gt;tag:tennis.org&lt;/id&gt;</span><br class="calibre10"/>  <span class="FontName">&lt;updated&gt;2010-03-04T20:51:50Z&lt;/updated&gt;</span><br class="calibre10"/>  <span class="FontName">&lt;entry&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;title&gt;Australian Open - Posted by ATP&lt;/title&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;id&gt;tag:tennis.org,2010-03-04:0&lt;/id&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;updated&gt;2010-03-04T20:51:50Z&lt;/updated&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;summary&gt;Australian Open -</span> <span class="FontName"><a href="http://www.australianopen.com" class="calibre5">www.australianopen.com</a></span><span class="FontName">&lt;/summary&gt;</span><br class="calibre10"/>  <span class="FontName">&lt;/entry&gt;</span><br class="calibre10"/>  <span class="FontName">&lt;entry&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;title&gt;Roland Garros - Posted by ATP&lt;/title&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;id&gt;tag:tennis.org,2010-03-04:1&lt;/id&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;updated&gt;2010-03-04T20:51:50Z&lt;/updated&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;summary&gt;Roland Garros -</span> <span class="FontName"><a href="http://www.rolandgarros.com" class="calibre5">www.rolandgarros.com</a></span><span class="FontName">&lt;/summary&gt;</span><br class="calibre10"/>  <span class="FontName">&lt;/entry&gt;</span><br class="calibre10"/>  <span class="FontName">&lt;entry&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;title&gt;Wimbledon - Posted by ATP&lt;/title&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;id&gt;tag:tennis.org,2010-03-04:2&lt;/id&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;updated&gt;2010-03-04T20:51:50Z&lt;/updated&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;summary&gt;Wimbledon -</span> <span class="FontName"><a href="http://www.wimbledon.org&lt;/summary" class="calibre5">www.wimbledon.org&lt;/summary</a></span><span class="FontName">&gt;</span><br class="calibre10"/>  <span class="FontName">&lt;/entry&gt;</span><br class="calibre10"/>  <span class="FontName">&lt;entry&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;title&gt;US Open - Posted by ATP&lt;/title&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;id&gt;tag:tennis.org,2010-03-04:3&lt;/id&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;updated&gt;2010-03-04T20:51:50Z&lt;/updated&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;summary&gt;US Open -</span> <span class="FontName"><a href="http://www.usopen.org&lt;/summary" class="calibre5">www.usopen.org&lt;/summary</a></span><span class="FontName">&gt;</span><br class="calibre10"/>  <span class="FontName">&lt;/entry&gt;</span><br class="calibre10"/><span class="FontName">&lt;/feed&gt;</span></pre>
<p class="indent">Turning your attention to the remaining handler method—<span class="FontName">getRSSFeed</span>—from the previous Spring MVC controller charged with building an RSS feed, you’ll see that the process is similar to the one just described for building Atom feeds.</p>
<p class="indent">The handler methods also creates a <span class="FontName">List</span> of <span class="FontName">TournamentContent</span> objects, which is then assigned to the handler method’s <span class="FontName">Model</span> object for it to become accessible to the returning view. The returning logical view in this case though, now corresponds to one named <span class="FontName">rssfeedtemplate</span>. As described earlier, this logical view is mapped to a class named <span class="FontName">RssFeedView</span>.</p>
<p class="indent">The following listing illustrates the <span class="FontName">RssFeedView</span> class<a id="cXXX.493" class="calibre5"></a>, which implements the <span class="FontName">AbstractRssFeedView</span> class:</p>
<pre class="calibre11"><span class="FontName">package com.apress.springrecipes.court.feeds;</span><br class="calibre10"/><br class="calibre10"/><span class="FontName">import javax.servlet.http.HttpServletRequest;</span><br class="calibre10"/><span class="FontName">import javax.servlet.http.HttpServletResponse;</span><br class="calibre10"/><br class="calibre10"/><b class="calibre4">import com.sun.syndication.feed.rss.Channel;</b><br class="calibre10"/><b class="calibre4">import com.sun.syndication.feed.rss.Item;</b><br class="calibre10"/><b class="calibre4">import org.springframework.web.servlet.view.feed.AbstractRssFeedView;</b><br class="calibre10"/><br class="calibre10"/><span class="FontName">import java.util.Date;</span><br class="calibre10"/><span class="FontName">import java.util.List;</span><br class="calibre10"/><span class="FontName">import java.util.ArrayList;</span><br class="calibre10"/><span class="FontName">import java.util.Map;</span><br class="calibre10"/><br class="calibre10"/><b class="calibre4">public class RSSFeedView extends AbstractRssFeedView {</b><br class="calibre10"/>    <b class="calibre4">protected void buildFeedMetadata(Map model, Channel feed, HttpServletRequest request) {</b><br class="calibre10"/>        <span class="FontName">feed.setTitle("World Soccer Tournaments");</span><br class="calibre10"/>        <span class="FontName">feed.setDescription("FIFA World Soccer Tournament Calendar");</span><br class="calibre10"/>        <span class="FontName">feed.setLink("tennis.org");</span><br class="calibre10"/>        <span class="FontName">List&lt;TournamentContent&gt; tournamentList = (List&lt;TournamentContent&gt;)model.get("feedContent");</span><br class="calibre10"/>        <span class="FontName">for (TournamentContent tournament : tournamentList) {</span><br class="calibre10"/>            <span class="FontName">Date date = tournament.getPublicationDate();</span><br class="calibre10"/>            <span class="FontName">if (feed.getLastBuildDate() == null || date.compareTo(feed.getLastBuildDate()) &gt; 0) {</span><br class="calibre10"/>                <span class="FontName">feed.setLastBuildDate(date);</span><br class="calibre10"/>            <span class="FontName">}</span><br class="calibre10"/>        <span class="FontName">}</span><br class="calibre10"/>    <span class="FontName">}</span><br class="calibre10"/><br class="calibre10"/>    <b class="calibre4">protected List buildFeedItems(Map model,<img src="../images/00053.jpeg" alt="image" class="calibre3"/></b><br class="calibre10"/>    <b class="calibre4">HttpServletRequest request, HttpServletResponse response) <img src="../images/00053.jpeg" alt="image" class="calibre3"/></b><br class="calibre10"/>    <b class="calibre4">throws Exception {</b><br class="calibre10"/>        <span class="FontName">List&lt;TournamentContent&gt; tournamentList = (List&lt;TournamentContent&gt;)model.get<img src="../images/00053.jpeg" alt="image" class="calibre3"/></span><br class="calibre10"/><span class="FontName">        ("feedContent");</span><br class="calibre10"/>        <span class="FontName">List&lt;Item&gt; items = new ArrayList&lt;Item&gt;(tournamentList.size());</span><br class="calibre10"/>        <span class="FontName">for (TournamentContent tournament : tournamentList) {</span><br class="calibre10"/>            <span class="FontName">Item item = new Item();</span><br class="calibre10"/>            <span class="FontName">String date = String.format("%1$tY-%1$tm-%1$td", tournament.get<img src="../images/00053.jpeg" alt="image" class="calibre3"/></span><br class="calibre10"/><span class="FontName">            PublicationDate());</span><br class="calibre10"/>            <span class="FontName">item.setAuthor(tournament.getAuthor());</span><br class="calibre10"/>            <span class="FontName">item.setTitle(String.format("%s - Posted by %s", tournament.getName(),<img src="../images/00053.jpeg" alt="image" class="calibre3"/></span><br class="calibre10"/>            <span class="FontName">tournament.getAuthor()));</span><br class="calibre10"/>            <span class="FontName">item.setPubDate(tournament.getPublicationDate());</span><br class="calibre10"/>            <span class="FontName">item.setLink(tournament.getLink());</span><br class="calibre10"/>            <span class="FontName">items.add(item);</span><br class="calibre10"/>            <span class="FontName">}</span><br class="calibre10"/>        <span class="FontName">return items;</span><br class="calibre10"/>       <span class="FontName">}</span><br class="calibre10"/>    <span class="FontName">}</span></pre>
<p class="indent">The first thing to notice about this class is that it imports several Project Rome classes from the <span class="FontName">com.sun.syndication.feed.rss</span> package, in addition to implementing the <span class="FontName">AbstractRssFeedView</span> class provided by the Spring framework. Once it does so, the only thing that’s needed next is to provide a feed’s implementation details for two methods inherited from the <span class="FontName">AbstractRssFeedView</span> class: <span class="FontName">buildFeedMetadata</span> and <span class="FontName">buildFeedItems</span>.</p>
<p class="indent">The <span class="FontName">buildFeedMetadata</span> method is similar in nature to the one by the same name used in building an Atom feed. Notice the <span class="FontName">buildFeedMetadata</span> method manipulates a <span class="FontName">Channel</span> object based on a Project Rome class, which is used to build RSS feeds, instead of a <span class="FontName">Feed</span> object, which is used to build Atom feeds. The setter method calls made on the <span class="FontName">Channel</span> object (e.g., <span class="FontName">setTitle</span>, <span class="FontName">setDescription</span>, <span class="FontName">setLink</span>) represent the assignment of an RSS feed’s metadata information.</p>
<p class="indent">The <span class="FontName">buildFeedItems</span> method<a id="cXXX.494" class="calibre5"></a>, which differs in name to its Atom counterpart <span class="FontName">buildFeedEntries</span>, is so named because an Atom feed’s recurring elements are called <i class="calibre8">entries</i> and an RSS feed’s recurring elements are <i class="calibre8">items</i>. Naming conventions aside, their logic is similar.</p>
<p class="indent">Inside the <span class="FontName">buildFeedItems</span> method, you can observe that the <span class="FontName">Map</span> object is accessed to obtain the <span class="FontName">feedContent</span> object assigned inside the handler method. Once this is done, an empty <span class="FontName">List</span> of <span class="FontName">Item</span> objects is created. Next, a loop is performed on the <span class="FontName">feedContent</span> object, which contains a list of a <span class="FontName">List</span> of <span class="FontName">TournamentContent</span> objects, and for each element, an <span class="FontName">Item</span> object is created which is assigned to the top level <span class="FontName">List</span> of <span class="FontName">Item</span> objects. Once the loop is finished, the method returns a filled <span class="FontName">List</span> of <span class="FontName">Item</span> objects.</p>
<div class="notepara">
<p class="paraaftertitle"><img src="../images/00016.jpeg" alt="Image" class="calibre3"/> <b class="calibre4">Note</b>  Consult Project Rome’s API if you want to assign more values to an RSS feed’s metadata and recurring element sections, as well as specify a particular RSS version. The default version is RSS 2.0.</p></div>
<p class="indent">When you deploy this last class, in addition to the previously cited Spring MVC controller, accessing a URL in the form <span class="FontName">http://[host_name]/rssfeed.rss</span> (or <span class="FontName">http://[host_name]/rssfeed.xml</span>) results in the following response:</p>
<pre class="calibre11"><span class="FontName">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br class="calibre10"/><span class="FontName">&lt;rss version="2.0"&gt;</span><br class="calibre10"/>  <span class="FontName">&lt;channel&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;title&gt;World Soccer Tournaments&lt;/title&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;link&gt;tennis.org&lt;/link&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;description&gt;FIFA World Soccer Tournament Calendar&lt;/description&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;lastBuildDate&gt;Thu, 04 Mar 2010 21:45:08 GMT&lt;/lastBuildDate&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;item&gt;</span><br class="calibre10"/>      <span class="FontName">&lt;title&gt;World Cup - Posted by FIFA&lt;/title&gt;</span><br class="calibre10"/>      <span class="FontName">&lt;link&gt;</span><span class="FontName"><a href="http://www.fifa.com/worldcup/" class="calibre5">www.fifa.com/worldcup/</a></span><span class="FontName">&lt;/link&gt;</span><br class="calibre10"/>      <span class="FontName">&lt;pubDate&gt;Thu, 04 Mar 2010 21:45:08 GMT&lt;/pubDate&gt;</span><br class="calibre10"/>      <span class="FontName">272103_1_EnFIFA&lt;/author&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;/item&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;item&gt;</span><br class="calibre10"/>      <span class="FontName">&lt;title&gt;U-20 World Cup - Posted by FIFA&lt;/title&gt;</span><br class="calibre10"/>      <span class="FontName">&lt;link&gt;</span><span class="FontName"><a href="http://www.fifa.com/u20worldcup/" class="calibre5">www.fifa.com/u20worldcup/</a></span><span class="FontName">&lt;/link&gt;</span><br class="calibre10"/>      <span class="FontName">&lt;pubDate&gt;Thu, 04 Mar 2010 21:45:08 GMT&lt;/pubDate&gt;</span><br class="calibre10"/>      <span class="FontName">272103_1_EnFIFA&lt;/author&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;/item&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;item&gt;</span><br class="calibre10"/>      <span class="FontName">&lt;title&gt;U-17 World Cup - Posted by FIFA&lt;/title&gt;</span><br class="calibre10"/>      <span class="FontName">&lt;link&gt;</span><span class="FontName"><a href="http://www.fifa.com/u17worldcup/" class="calibre5">www.fifa.com/u17worldcup/</a></span><span class="FontName">&lt;/link&gt;</span><br class="calibre10"/>      <span class="FontName">&lt;pubDate&gt;Thu, 04 Mar 2010 21:45:08 GMT&lt;/pubDate&gt;</span><br class="calibre10"/>      <span class="FontName">272103_1_EnFIFA&lt;/author&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;/item&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;item&gt;</span><br class="calibre10"/>      <span class="FontName">&lt;title&gt;Confederations Cup - Posted by FIFA&lt;/title&gt;</span><br class="calibre10"/>      <span class="FontName">&lt;link&gt;</span><span class="FontName"><a href="http://www.fifa.com/confederationscup/" class="calibre5">www.fifa.com/confederationscup/</a></span><span class="FontName">&lt;/link&gt;</span><br class="calibre10"/>      <span class="FontName">&lt;pubDate&gt;Thu, 04 Mar 2010 21:45:08 GMT&lt;/pubDate&gt;</span><br class="calibre10"/>      <span class="FontName">272103_1_EnFIFA&lt;/author&gt;</span><br class="calibre10"/>    <span class="FontName">&lt;/item&gt;</span><br class="calibre10"/>  <span class="FontName">&lt;/channel&gt;</span><br class="calibre10"/><span class="FontName">&lt;/rss&gt;</span></pre>
<p id="Sec25" class="Heading">Summary</p>
<p class="noindent">In this chapter, you have learned how to develop and access REST services using Spring. REST services are closely tied to Spring MVC, whereby a controller acts to dispatch requests made to REST services, as well as access third-party REST services to use this information for application content.</p>
<p class="indent">You learned how REST services leverage annotations used in Spring MVC controllers, which included <span class="FontName">@RequestMapping</span> to indicate service end points, as well as <span class="FontName">@PathVariable</span> to specify access parameters for filtering a service’s payload. In addition, you learned about Spring’s XML marshallers, such as <span class="FontName">Jaxb2Marshaller</span>, which allow application objects to be transformed into XML and be output as a REST service’s payload.</p>
<p class="indent">You also learned about Spring’s <span class="FontName">RestTemplate</span> class and how it supports the series of HTTP protocol methods that include <span class="FontName">HEAD</span>, <span class="FontName">GET</span>, <span class="FontName">POST</span>, <span class="FontName">PUT</span>, and <span class="FontName">DELETE</span>—all of which allow you to access and perform operations on third-party REST services directly from the context of a Spring application.</p>
<p class="indent">Finally you explored how to publish Atom and RSS feeds in a Spring application by leveraging the Project Rome API.</p></div>
</body></html>
